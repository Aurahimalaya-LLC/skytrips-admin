{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/buddh/skytrips-admin/src/lib/env.ts"],"sourcesContent":["/**\r\n * Environment Configuration and Validation\r\n * \r\n * This module handles loading and validating environment variables.\r\n * It ensures that all required configuration is present before the application\r\n * attempts to use it, preventing runtime errors due to missing config.\r\n */\r\n\r\ninterface Config {\r\n  supabase: {\r\n    url: string;\r\n    anonKey: string;\r\n    serviceRoleKey?: string;\r\n  };\r\n}\r\n\r\nconst requiredClientVars = [\r\n  'NEXT_PUBLIC_SUPABASE_URL',\r\n  'NEXT_PUBLIC_SUPABASE_ANON_KEY'\r\n];\r\n\r\nconst requiredServerVars = [\r\n  'SUPABASE_SERVICE_ROLE_KEY'\r\n];\r\n\r\n/**\r\n * Validates the presence of required environment variables.\r\n * Returns an object containing the validated configuration.\r\n * Logs errors for any missing variables.\r\n */\r\nexport function validateConfig() {\r\n  const missing: string[] = [];\r\n  const config: Config = {\r\n    supabase: {\r\n      url: process.env.NEXT_PUBLIC_SUPABASE_URL || '',\r\n      anonKey: process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || '',\r\n      serviceRoleKey: process.env.SUPABASE_SERVICE_ROLE_KEY || '',\r\n    }\r\n  };\r\n\r\n  // Check client-side vars explicitly to ensure they are inlined by Next.js\r\n  if (!process.env.NEXT_PUBLIC_SUPABASE_URL) {\r\n    missing.push('NEXT_PUBLIC_SUPABASE_URL');\r\n  }\r\n  if (!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {\r\n    missing.push('NEXT_PUBLIC_SUPABASE_ANON_KEY');\r\n  }\r\n\r\n  // Check server-side vars only if running on server\r\n  if (typeof window === 'undefined') {\r\n    if (!process.env.SUPABASE_SERVICE_ROLE_KEY) {\r\n      missing.push('SUPABASE_SERVICE_ROLE_KEY');\r\n    }\r\n  }\r\n\r\n  if (missing.length > 0) {\r\n    const errorMsg = `Missing required environment variables: ${missing.join(', ')}`;\r\n    console.error(`[Configuration Error] ${errorMsg}`);\r\n    \r\n    // In strict mode, you might want to throw an error\r\n    // throw new Error(errorMsg);\r\n    \r\n    return {\r\n      isValid: false,\r\n      missing,\r\n      config\r\n    };\r\n  }\r\n\r\n  return {\r\n    isValid: true,\r\n    missing: [],\r\n    config\r\n  };\r\n}\r\n\r\n// Export a singleton instance of the validated config\r\nconst validationResult = validateConfig();\r\n\r\nexport const env = {\r\n  ...validationResult.config,\r\n  isValid: validationResult.isValid,\r\n  missing: validationResult.missing\r\n};\r\n"],"names":[],"mappings":"AAAA;;;;;;CAMC;;;;;;AA4BU;AAlBX,MAAM,qBAAqB;IACzB;IACA;CACD;AAED,MAAM,qBAAqB;IACzB;CACD;AAOM,SAAS;IACd,MAAM,UAAoB,EAAE;IAC5B,MAAM,SAAiB;QACrB,UAAU;YACR,KAAK,gFAAwC;YAC7C,SAAS,sFAA6C;YACtD,gBAAgB,gMAAO,CAAC,GAAG,CAAC,yBAAyB,IAAI;QAC3D;IACF;IAEA,0EAA0E;IAC1E;;IAGA;;IAIA,mDAAmD;IACnD;;IAMA,IAAI,QAAQ,MAAM,GAAG,GAAG;QACtB,MAAM,WAAW,CAAC,wCAAwC,EAAE,QAAQ,IAAI,CAAC,OAAO;QAChF,QAAQ,KAAK,CAAC,CAAC,sBAAsB,EAAE,UAAU;QAEjD,mDAAmD;QACnD,6BAA6B;QAE7B,OAAO;YACL,SAAS;YACT;YACA;QACF;IACF;IAEA,OAAO;QACL,SAAS;QACT,SAAS,EAAE;QACX;IACF;AACF;AAEA,sDAAsD;AACtD,MAAM,mBAAmB;AAElB,MAAM,MAAM;IACjB,GAAG,iBAAiB,MAAM;IAC1B,SAAS,iBAAiB,OAAO;IACjC,SAAS,iBAAiB,OAAO;AACnC"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/buddh/skytrips-admin/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\nimport { env } from \"./env\";\r\n\r\nif (!env.isValid) {\r\n  console.error(\r\n    \"Missing Supabase environment variables. Please check your .env.local file.\"\r\n  );\r\n}\r\n\r\nexport const supabase = createClient(\r\n  env.supabase.url || \"https://placeholder.supabase.co\",\r\n  env.supabase.anonKey || \"placeholder\"\r\n);\r\n\r\n// Helper function to check if user is admin\r\nexport async function isUserAdmin(userId: string): Promise<boolean> {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from(\"user_roles\")\r\n      .select(\"role\")\r\n      .eq(\"user_id\", userId)\r\n      .single();\r\n\r\n    if (error) {\r\n      console.error(\"Error checking user role:\", error);\r\n      return false;\r\n    }\r\n\r\n    return data?.role === \"admin\";\r\n  } catch (error) {\r\n    console.error(\"Error in isUserAdmin:\", error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Get current session\r\nexport async function getCurrentSession() {\r\n  const {\r\n    data: { session },\r\n    error,\r\n  } = await supabase.auth.getSession();\r\n  if (error) {\r\n    console.error(\"Error getting session:\", error);\r\n    return null;\r\n  }\r\n  return session;\r\n}\r\n\r\n// Get current user with admin check\r\nexport async function getCurrentUser() {\r\n  const session = await getCurrentSession();\r\n  if (!session?.user) {\r\n    return { user: null, isAdmin: false };\r\n  }\r\n\r\n  const isAdmin = await isUserAdmin(session.user.id);\r\n  return { user: session.user, isAdmin };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,IAAI,CAAC,gJAAG,CAAC,OAAO,EAAE;IAChB,QAAQ,KAAK,CACX;AAEJ;AAEO,MAAM,WAAW,IAAA,sNAAY,EAClC,gJAAG,CAAC,QAAQ,CAAC,GAAG,IAAI,mCACpB,gJAAG,CAAC,QAAQ,CAAC,OAAO,IAAI;AAInB,eAAe,YAAY,MAAc;IAC9C,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,cACL,MAAM,CAAC,QACP,EAAE,CAAC,WAAW,QACd,MAAM;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,6BAA6B;YAC3C,OAAO;QACT;QAEA,OAAO,MAAM,SAAS;IACxB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO;IACT;AACF;AAGO,eAAe;IACpB,MAAM,EACJ,MAAM,EAAE,OAAO,EAAE,EACjB,KAAK,EACN,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;IAClC,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO;IACT;IACA,OAAO;AACT;AAGO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,IAAI,CAAC,SAAS,MAAM;QAClB,OAAO;YAAE,MAAM;YAAM,SAAS;QAAM;IACtC;IAEA,MAAM,UAAU,MAAM,YAAY,QAAQ,IAAI,CAAC,EAAE;IACjD,OAAO;QAAE,MAAM,QAAQ,IAAI;QAAE;IAAQ;AACvC"}},
    {"offset": {"line": 132, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/buddh/skytrips-admin/src/components/AirportAutocomplete.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useRef, type ChangeEvent, type KeyboardEvent } from \"react\";\r\n\r\ninterface Airport {\r\n  name: string;\r\n  city: string;\r\n  country: string;\r\n  IATA: string;\r\n  ICAO: string;\r\n  lat: string;\r\n  lon: string;\r\n  timezone: string;\r\n}\r\n\r\ninterface AirportAutocompleteProps {\r\n  label: string;\r\n  name: string;\r\n  value: string;\r\n  onChange: (e: ChangeEvent<HTMLInputElement> | { target: { name: string; value: string } }) => void;\r\n  disabled?: boolean;\r\n  icon: string;\r\n}\r\n\r\nconst AirportAutocomplete = ({ label, name, value, onChange, disabled, icon }: AirportAutocompleteProps) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [allAirports, setAllAirports] = useState<Airport[]>([]);\r\n  const [filteredOptions, setFilteredOptions] = useState<Airport[]>([]);\r\n  const [activeIndex, setActiveIndex] = useState<number>(-1);\r\n  const wrapperRef = useRef<HTMLDivElement>(null);\r\n  const listboxId = `${name}-listbox`;\r\n\r\n  useEffect(() => {\r\n    import(\"../../libs/shared-utils/constants/airport\")\r\n      .then((mod) => {\r\n        setAllAirports(mod.airports as Airport[]);\r\n      })\r\n      .catch(() => {\r\n        setAllAirports([]);\r\n      });\r\n\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (wrapperRef.current && !wrapperRef.current.contains(event.target as Node)) {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (isOpen && allAirports.length > 0) {\r\n      if (!value) {\r\n        setFilteredOptions(allAirports.slice(0, 50));\r\n      } else {\r\n        const lower = value.toLowerCase();\r\n        const filtered = allAirports.filter(\r\n          (a) =>\r\n            (a.name && a.name.toLowerCase().includes(lower)) ||\r\n            (a.IATA && a.IATA.toLowerCase().includes(lower)) ||\r\n            (a.city && a.city.toLowerCase().includes(lower))\r\n        );\r\n        setFilteredOptions(filtered.slice(0, 50));\r\n      }\r\n    }\r\n  }, [value, isOpen, allAirports]);\r\n\r\n  const highlight = (text: string, query: string) => {\r\n    const idx = text.toLowerCase().indexOf(query.toLowerCase());\r\n    if (idx === -1 || !query) return text;\r\n    return (\r\n      <>\r\n        {text.slice(0, idx)}\r\n        <mark className=\"bg-yellow-100\">{text.slice(idx, idx + query.length)}</mark>\r\n        {text.slice(idx + query.length)}\r\n      </>\r\n    );\r\n  };\r\n\r\n  const handleKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n    if (!isOpen || filteredOptions.length === 0) return;\r\n    if (e.key === \"ArrowDown\") {\r\n      e.preventDefault();\r\n      setActiveIndex((prev) => (prev + 1) % filteredOptions.length);\r\n    } else if (e.key === \"ArrowUp\") {\r\n      e.preventDefault();\r\n      setActiveIndex((prev) => (prev <= 0 ? filteredOptions.length - 1 : prev - 1));\r\n    } else if (e.key === \"Enter\") {\r\n      e.preventDefault();\r\n      if (activeIndex >= 0) {\r\n        const option = filteredOptions[activeIndex];\r\n        onChange({\r\n          target: {\r\n            name,\r\n            value: `${option.name} (${option.IATA})`,\r\n          },\r\n        });\r\n        setIsOpen(false);\r\n        setActiveIndex(-1);\r\n      }\r\n    } else if (e.key === \"Escape\") {\r\n      setIsOpen(false);\r\n      setActiveIndex(-1);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative\" ref={wrapperRef}>\r\n      <label className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\">\r\n        {label}\r\n      </label>\r\n      <div className=\"relative\">\r\n        <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none\">\r\n          <span className=\"material-symbols-outlined text-slate-400\" style={{ fontSize: \"20px\" }}>\r\n            {icon}\r\n          </span>\r\n        </div>\r\n        <input\r\n          role=\"combobox\"\r\n          aria-expanded={isOpen}\r\n          aria-controls={listboxId}\r\n          className=\"block w-full h-12 pl-12 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium\"\r\n          name={name}\r\n          placeholder=\"City or Airport\"\r\n          type=\"text\"\r\n          value={value}\r\n          onChange={(e) => {\r\n            onChange(e);\r\n            setIsOpen(true);\r\n            setActiveIndex(-1);\r\n          }}\r\n          onFocus={() => setIsOpen(true)}\r\n          onKeyDown={handleKeyDown}\r\n          disabled={disabled}\r\n          autoComplete=\"off\"\r\n        />\r\n        {value && (\r\n          <button\r\n            type=\"button\"\r\n            aria-label=\"Clear search\"\r\n            className=\"absolute right-2 top-1/2 -translate-y-1/2 p-2 text-slate-400 hover:text-slate-600\"\r\n            onClick={() => {\r\n              onChange({ target: { name, value: \"\" } });\r\n              setActiveIndex(-1);\r\n            }}\r\n          >\r\n            <span className=\"material-symbols-outlined text-[18px]\">close</span>\r\n          </button>\r\n        )}\r\n      </div>\r\n      {isOpen && filteredOptions.length > 0 && (\r\n        <ul\r\n          id={listboxId}\r\n          role=\"listbox\"\r\n          className=\"absolute z-50 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-xl max-h-60 overflow-auto\"\r\n        >\r\n          {filteredOptions.map((option, index) => (\r\n            <li\r\n              role=\"option\"\r\n              aria-selected={activeIndex === index}\r\n              key={index}\r\n              className={`px-4 py-3 hover:bg-slate-50 cursor-pointer border-b border-slate-50 last:border-none group ${activeIndex === index ? \"bg-slate-50\" : \"\"}`}\r\n              onClick={() => {\r\n                onChange({\r\n                  target: {\r\n                    name,\r\n                    value: `${option.name} (${option.IATA})`,\r\n                  },\r\n                });\r\n                setIsOpen(false);\r\n                setActiveIndex(-1);\r\n              }}\r\n            >\r\n              <div className=\"flex justify-between items-center\">\r\n                <div>\r\n                  <div className=\"font-bold text-slate-700 text-sm group-hover:text-primary transition-colors\">\r\n                    {highlight(option.city, value)}\r\n                  </div>\r\n                  <div className=\"text-xs text-slate-500 mt-0.5\">\r\n                    {highlight(option.name, value)}\r\n                  </div>\r\n                </div>\r\n                <div className=\"bg-slate-100 px-2 py-1 rounded text-xs font-black text-slate-600 group-hover:bg-blue-100 group-hover:text-blue-700 transition-colors\">\r\n                  {highlight(option.IATA, value)}\r\n                </div>\r\n              </div>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AirportAutocomplete;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 413, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/buddh/skytrips-admin/src/components/AirlineAutocomplete.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport airlineData from \"../../libs/shared-utils/constants/airline.json\";\r\n\r\ninterface Airline {\r\n  name: string;\r\n  iata?: string;\r\n  icao?: string;\r\n  country?: string;\r\n}\r\n\r\ninterface AirlineAutocompleteProps {\r\n  label: string;\r\n  name: string;\r\n  value: string;\r\n  onChange: (e: any) => void;\r\n  disabled?: boolean;\r\n  icon: string;\r\n}\r\n\r\nconst AirlineAutocomplete = ({ label, name, value, onChange, disabled, icon }: AirlineAutocompleteProps) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [filteredOptions, setFilteredOptions] = useState<Airline[]>([]);\r\n  const [activeIndex, setActiveIndex] = useState<number>(-1);\r\n  const wrapperRef = useRef<HTMLDivElement>(null);\r\n  const listboxId = `${name}-listbox`;\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (wrapperRef.current && !wrapperRef.current.contains(event.target as Node)) {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      const airlines = (airlineData as any).airlinecodes as Airline[];\r\n      if (!value) {\r\n        setFilteredOptions(airlines.slice(0, 50));\r\n      } else {\r\n        const lower = value.toLowerCase();\r\n        const filtered = airlines.filter(\r\n          (a) =>\r\n            (a.name && a.name.toLowerCase().includes(lower)) ||\r\n            (a.iata && a.iata.toLowerCase().includes(lower))\r\n        );\r\n        setFilteredOptions(filtered.slice(0, 50));\r\n      }\r\n    }\r\n  }, [value, isOpen]);\r\n\r\n  const highlight = (text: string, query: string) => {\r\n    if (!text) return \"\";\r\n    const idx = text.toLowerCase().indexOf(query.toLowerCase());\r\n    if (idx === -1 || !query) return text;\r\n    return (\r\n      <>\r\n        {text.slice(0, idx)}\r\n        <mark className=\"bg-yellow-100\">{text.slice(idx, idx + query.length)}</mark>\r\n        {text.slice(idx + query.length)}\r\n      </>\r\n    );\r\n  };\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (!isOpen || filteredOptions.length === 0) return;\r\n    if (e.key === \"ArrowDown\") {\r\n      e.preventDefault();\r\n      setActiveIndex((prev) => (prev + 1) % filteredOptions.length);\r\n    } else if (e.key === \"ArrowUp\") {\r\n      e.preventDefault();\r\n      setActiveIndex((prev) => (prev <= 0 ? filteredOptions.length - 1 : prev - 1));\r\n    } else if (e.key === \"Enter\") {\r\n      e.preventDefault();\r\n      if (activeIndex >= 0) {\r\n        const option = filteredOptions[activeIndex];\r\n        onChange({\r\n          target: {\r\n            name,\r\n            value: `${option.name}`,\r\n          },\r\n        });\r\n        setIsOpen(false);\r\n        setActiveIndex(-1);\r\n      }\r\n    } else if (e.key === \"Escape\") {\r\n      setIsOpen(false);\r\n      setActiveIndex(-1);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative\" ref={wrapperRef}>\r\n      <label className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\">\r\n        {label}\r\n      </label>\r\n      <div className=\"relative\">\r\n        <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none\">\r\n          <span className=\"material-symbols-outlined text-slate-400\" style={{ fontSize: \"20px\" }}>\r\n            {icon}\r\n          </span>\r\n        </div>\r\n        <input\r\n          role=\"combobox\"\r\n          aria-expanded={isOpen}\r\n          aria-controls={listboxId}\r\n          className=\"block w-full h-12 pl-12 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium\"\r\n          name={name}\r\n          placeholder=\"Airline Name\"\r\n          type=\"text\"\r\n          value={value}\r\n          onChange={(e) => {\r\n            onChange(e);\r\n            setIsOpen(true);\r\n            setActiveIndex(-1);\r\n          }}\r\n          onFocus={() => setIsOpen(true)}\r\n          onKeyDown={handleKeyDown}\r\n          disabled={disabled}\r\n          autoComplete=\"off\"\r\n        />\r\n        {value && (\r\n          <button\r\n            type=\"button\"\r\n            aria-label=\"Clear search\"\r\n            className=\"absolute right-2 top-1/2 -translate-y-1/2 p-2 text-slate-400 hover:text-slate-600\"\r\n            onClick={() => {\r\n              onChange({ target: { name, value: \"\" } });\r\n              setActiveIndex(-1);\r\n            }}\r\n          >\r\n            <span className=\"material-symbols-outlined text-[18px]\">close</span>\r\n          </button>\r\n        )}\r\n      </div>\r\n      {isOpen && filteredOptions.length > 0 && (\r\n        <ul\r\n          id={listboxId}\r\n          role=\"listbox\"\r\n          className=\"absolute z-50 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-xl max-h-60 overflow-auto\"\r\n        >\r\n          {filteredOptions.map((option, index) => (\r\n            <li\r\n              role=\"option\"\r\n              aria-selected={activeIndex === index}\r\n              key={index}\r\n              className={`px-4 py-3 hover:bg-slate-50 cursor-pointer border-b border-slate-50 last:border-none group ${activeIndex === index ? \"bg-slate-50\" : \"\"}`}\r\n              onClick={() => {\r\n                onChange({\r\n                  target: {\r\n                    name,\r\n                    value: `${option.name}`,\r\n                  },\r\n                });\r\n                setIsOpen(false);\r\n                setActiveIndex(-1);\r\n              }}\r\n            >\r\n              <div className=\"flex justify-between items-center\">\r\n                <div>\r\n                  <div className=\"font-bold text-slate-700 text-sm group-hover:text-primary transition-colors\">\r\n                    {highlight(option.name, value)}\r\n                  </div>\r\n                </div>\r\n                {option.iata && option.iata !== '-' && (\r\n                  <div className=\"bg-slate-100 px-2 py-1 rounded text-xs font-black text-slate-600 group-hover:bg-blue-100 group-hover:text-blue-700 transition-colors\">\r\n                    {highlight(option.iata, value)}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AirlineAutocomplete;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 677, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/buddh/skytrips-admin/src/components/CustomerSearch.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { Customer } from \"@/types\";\r\n\r\ninterface CustomerSearchProps {\r\n  onSelect: (customer: Customer) => void;\r\n  className?: string;\r\n}\r\n\r\nexport default function CustomerSearch({ onSelect, className = \"\" }: CustomerSearchProps) {\r\n  const [query, setQuery] = useState(\"\");\r\n  const [results, setResults] = useState<Customer[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const wrapperRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (wrapperRef.current && !wrapperRef.current.contains(event.target as Node)) {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const searchCustomers = async () => {\r\n      if (query.trim().length < 2) {\r\n        setResults([]);\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      try {\r\n        const { data, error } = await supabase\r\n          .from(\"customers\")\r\n          .select(\"*\")\r\n          .or(`firstName.ilike.%${query}%,lastName.ilike.%${query}%,email.ilike.%${query}%,phone.ilike.%${query}%`)\r\n          .limit(5);\r\n\r\n        if (error) throw error;\r\n        setResults(data || []);\r\n      } catch (err) {\r\n        console.error(\"Error searching customers:\", err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    const timer = setTimeout(searchCustomers, 300);\r\n    return () => clearTimeout(timer);\r\n  }, [query]);\r\n\r\n  return (\r\n    <div className={`relative ${className}`} ref={wrapperRef}>\r\n      <div className=\"relative\">\r\n        <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n          <span className=\"material-symbols-outlined text-slate-400 text-[18px]\">search</span>\r\n        </div>\r\n        <input\r\n          type=\"text\"\r\n          className=\"block w-full h-10 rounded-lg border-slate-200 pl-10 focus:border-primary focus:ring focus:ring-primary/10 sm:text-sm\"\r\n          placeholder=\"Search existing contact by name, email or phone...\"\r\n          value={query}\r\n          onChange={(e) => {\r\n            setQuery(e.target.value);\r\n            setIsOpen(true);\r\n          }}\r\n          onFocus={() => setIsOpen(true)}\r\n        />\r\n        {loading && (\r\n          <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\r\n            <div className=\"animate-spin h-4 w-4 border-2 border-primary border-t-transparent rounded-full\"></div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {isOpen && results.length > 0 && (\r\n        <ul className=\"absolute z-10 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg max-h-60 overflow-auto\">\r\n          {results.map((customer) => (\r\n            <li\r\n              key={customer.id}\r\n              className=\"px-4 py-3 hover:bg-slate-50 cursor-pointer border-b border-slate-100 last:border-none transition-colors\"\r\n              onClick={() => {\r\n                onSelect(customer);\r\n                setQuery(`${customer.firstName} ${customer.lastName}`);\r\n                setIsOpen(false);\r\n              }}\r\n            >\r\n              <div className=\"flex justify-between items-start\">\r\n                <div>\r\n                  <div className=\"font-bold text-slate-900 text-sm\">\r\n                    {customer.firstName} {customer.lastName}\r\n                  </div>\r\n                  <div className=\"text-xs text-slate-500 mt-0.5\">{customer.email}</div>\r\n                </div>\r\n                <div className=\"text-xs font-medium text-slate-600 bg-slate-100 px-2 py-1 rounded\">\r\n                  {customer.phone}\r\n                </div>\r\n              </div>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      )}\r\n\r\n      {isOpen && query.length >= 2 && !loading && results.length === 0 && (\r\n        <div className=\"absolute z-10 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg p-4 text-center text-sm text-slate-500\">\r\n          No customers found matching \"{query}\"\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAWe,SAAS,eAAe,EAAE,QAAQ,EAAE,YAAY,EAAE,EAAuB;;IACtF,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,8LAAQ,EAAC;IACnC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,8LAAQ,EAAa,EAAE;IACrD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,8LAAQ,EAAC;IACvC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,8LAAQ,EAAC;IACrC,MAAM,aAAa,IAAA,4LAAM,EAAiB;IAE1C,IAAA,+LAAS;oCAAC;YACR,MAAM;+DAAqB,CAAC;oBAC1B,IAAI,WAAW,OAAO,IAAI,CAAC,WAAW,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,GAAW;wBAC5E,UAAU;oBACZ;gBACF;;YACA,SAAS,gBAAgB,CAAC,aAAa;YACvC;4CAAO,IAAM,SAAS,mBAAmB,CAAC,aAAa;;QACzD;mCAAG,EAAE;IAEL,IAAA,+LAAS;oCAAC;YACR,MAAM;4DAAkB;oBACtB,IAAI,MAAM,IAAI,GAAG,MAAM,GAAG,GAAG;wBAC3B,WAAW,EAAE;wBACb;oBACF;oBAEA,WAAW;oBACX,IAAI;wBACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,0JAAQ,CACnC,IAAI,CAAC,aACL,MAAM,CAAC,KACP,EAAE,CAAC,CAAC,iBAAiB,EAAE,MAAM,kBAAkB,EAAE,MAAM,eAAe,EAAE,MAAM,eAAe,EAAE,MAAM,CAAC,CAAC,EACvG,KAAK,CAAC;wBAET,IAAI,OAAO,MAAM;wBACjB,WAAW,QAAQ,EAAE;oBACvB,EAAE,OAAO,KAAK;wBACZ,QAAQ,KAAK,CAAC,8BAA8B;oBAC9C,SAAU;wBACR,WAAW;oBACb;gBACF;;YAEA,MAAM,QAAQ,WAAW,iBAAiB;YAC1C;4CAAO,IAAM,aAAa;;QAC5B;mCAAG;QAAC;KAAM;IAEV,qBACE,kNAAC;QAAI,WAAW,CAAC,SAAS,EAAE,WAAW;QAAE,KAAK;;0BAC5C,kNAAC;gBAAI,WAAU;;kCACb,kNAAC;wBAAI,WAAU;kCACb,cAAA,kNAAC;4BAAK,WAAU;sCAAuD;;;;;;;;;;;kCAEzE,kNAAC;wBACC,MAAK;wBACL,WAAU;wBACV,aAAY;wBACZ,OAAO;wBACP,UAAU,CAAC;4BACT,SAAS,EAAE,MAAM,CAAC,KAAK;4BACvB,UAAU;wBACZ;wBACA,SAAS,IAAM,UAAU;;;;;;oBAE1B,yBACC,kNAAC;wBAAI,WAAU;kCACb,cAAA,kNAAC;4BAAI,WAAU;;;;;;;;;;;;;;;;;YAKpB,UAAU,QAAQ,MAAM,GAAG,mBAC1B,kNAAC;gBAAG,WAAU;0BACX,QAAQ,GAAG,CAAC,CAAC,yBACZ,kNAAC;wBAEC,WAAU;wBACV,SAAS;4BACP,SAAS;4BACT,SAAS,GAAG,SAAS,SAAS,CAAC,CAAC,EAAE,SAAS,QAAQ,EAAE;4BACrD,UAAU;wBACZ;kCAEA,cAAA,kNAAC;4BAAI,WAAU;;8CACb,kNAAC;;sDACC,kNAAC;4CAAI,WAAU;;gDACZ,SAAS,SAAS;gDAAC;gDAAE,SAAS,QAAQ;;;;;;;sDAEzC,kNAAC;4CAAI,WAAU;sDAAiC,SAAS,KAAK;;;;;;;;;;;;8CAEhE,kNAAC;oCAAI,WAAU;8CACZ,SAAS,KAAK;;;;;;;;;;;;uBAhBd,SAAS,EAAE;;;;;;;;;;YAwBvB,UAAU,MAAM,MAAM,IAAI,KAAK,CAAC,WAAW,QAAQ,MAAM,KAAK,mBAC7D,kNAAC;gBAAI,WAAU;;oBAAyH;oBACxG;oBAAM;;;;;;;;;;;;;AAK9C;GAxGwB;KAAA"}},
    {"offset": {"line": 890, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/buddh/skytrips-admin/src/components/TravellerSearch.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { Traveller } from \"@/types\";\r\n\r\ninterface TravellerSearchProps {\r\n  onSelect: (traveller: any) => void;\r\n  className?: string;\r\n}\r\n\r\nexport default function TravellerSearch({ onSelect, className = \"\" }: TravellerSearchProps) {\r\n  const [query, setQuery] = useState(\"\");\r\n  const [results, setResults] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const wrapperRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (wrapperRef.current && !wrapperRef.current.contains(event.target as Node)) {\r\n        setIsOpen(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const searchTravellers = async () => {\r\n      if (query.trim().length < 2) {\r\n        setResults([]);\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      try {\r\n        const { data, error } = await supabase\r\n          .from(\"travellers\")\r\n          .select(\"*\")\r\n          .or(`first_name.ilike.%${query}%,last_name.ilike.%${query}%,passport_number.ilike.%${query}%`)\r\n          .limit(5);\r\n\r\n        if (error) throw error;\r\n        setResults(data || []);\r\n      } catch (err) {\r\n        console.error(\"Error searching travellers:\", err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    const timer = setTimeout(searchTravellers, 300);\r\n    return () => clearTimeout(timer);\r\n  }, [query]);\r\n\r\n  return (\r\n    <div className={`relative ${className}`} ref={wrapperRef}>\r\n      <div className=\"relative\">\r\n        <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\r\n          <span className=\"material-symbols-outlined text-slate-400 text-[18px]\">search</span>\r\n        </div>\r\n        <input\r\n          type=\"text\"\r\n          className=\"block w-full h-10 rounded-lg border-slate-200 pl-10 focus:border-primary focus:ring focus:ring-primary/10 sm:text-sm\"\r\n          placeholder=\"Search traveller by name or passport...\"\r\n          value={query}\r\n          onChange={(e) => {\r\n            setQuery(e.target.value);\r\n            setIsOpen(true);\r\n          }}\r\n          onFocus={() => setIsOpen(true)}\r\n        />\r\n        {loading && (\r\n          <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none\">\r\n            <div className=\"animate-spin h-4 w-4 border-2 border-primary border-t-transparent rounded-full\"></div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {isOpen && results.length > 0 && (\r\n        <ul className=\"absolute z-10 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg max-h-60 overflow-auto\">\r\n          {results.map((traveller) => (\r\n            <li\r\n              key={traveller.id}\r\n              className=\"px-4 py-3 hover:bg-slate-50 cursor-pointer border-b border-slate-100 last:border-none transition-colors\"\r\n              onClick={() => {\r\n                onSelect(traveller);\r\n                setQuery(`${traveller.first_name} ${traveller.last_name}`);\r\n                setIsOpen(false);\r\n              }}\r\n            >\r\n              <div className=\"flex justify-between items-start\">\r\n                <div>\r\n                  <div className=\"font-bold text-slate-900 text-sm\">\r\n                    {traveller.first_name} {traveller.last_name}\r\n                  </div>\r\n                  <div className=\"text-xs text-slate-500 mt-0.5\">{traveller.nationality}</div>\r\n                </div>\r\n                <div className=\"text-xs font-medium text-slate-600 bg-slate-100 px-2 py-1 rounded\">\r\n                  {traveller.passport_number}\r\n                </div>\r\n              </div>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      )}\r\n\r\n      {isOpen && query.length >= 2 && !loading && results.length === 0 && (\r\n        <div className=\"absolute z-10 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg p-4 text-center text-sm text-slate-500\">\r\n          No travellers found matching \"{query}\"\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAWe,SAAS,gBAAgB,EAAE,QAAQ,EAAE,YAAY,EAAE,EAAwB;;IACxF,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,8LAAQ,EAAC;IACnC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,8LAAQ,EAAQ,EAAE;IAChD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,8LAAQ,EAAC;IACvC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,8LAAQ,EAAC;IACrC,MAAM,aAAa,IAAA,4LAAM,EAAiB;IAE1C,IAAA,+LAAS;qCAAC;YACR,MAAM;gEAAqB,CAAC;oBAC1B,IAAI,WAAW,OAAO,IAAI,CAAC,WAAW,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,GAAW;wBAC5E,UAAU;oBACZ;gBACF;;YACA,SAAS,gBAAgB,CAAC,aAAa;YACvC;6CAAO,IAAM,SAAS,mBAAmB,CAAC,aAAa;;QACzD;oCAAG,EAAE;IAEL,IAAA,+LAAS;qCAAC;YACR,MAAM;8DAAmB;oBACvB,IAAI,MAAM,IAAI,GAAG,MAAM,GAAG,GAAG;wBAC3B,WAAW,EAAE;wBACb;oBACF;oBAEA,WAAW;oBACX,IAAI;wBACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,0JAAQ,CACnC,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,CAAC,kBAAkB,EAAE,MAAM,mBAAmB,EAAE,MAAM,yBAAyB,EAAE,MAAM,CAAC,CAAC,EAC5F,KAAK,CAAC;wBAET,IAAI,OAAO,MAAM;wBACjB,WAAW,QAAQ,EAAE;oBACvB,EAAE,OAAO,KAAK;wBACZ,QAAQ,KAAK,CAAC,+BAA+B;oBAC/C,SAAU;wBACR,WAAW;oBACb;gBACF;;YAEA,MAAM,QAAQ,WAAW,kBAAkB;YAC3C;6CAAO,IAAM,aAAa;;QAC5B;oCAAG;QAAC;KAAM;IAEV,qBACE,kNAAC;QAAI,WAAW,CAAC,SAAS,EAAE,WAAW;QAAE,KAAK;;0BAC5C,kNAAC;gBAAI,WAAU;;kCACb,kNAAC;wBAAI,WAAU;kCACb,cAAA,kNAAC;4BAAK,WAAU;sCAAuD;;;;;;;;;;;kCAEzE,kNAAC;wBACC,MAAK;wBACL,WAAU;wBACV,aAAY;wBACZ,OAAO;wBACP,UAAU,CAAC;4BACT,SAAS,EAAE,MAAM,CAAC,KAAK;4BACvB,UAAU;wBACZ;wBACA,SAAS,IAAM,UAAU;;;;;;oBAE1B,yBACC,kNAAC;wBAAI,WAAU;kCACb,cAAA,kNAAC;4BAAI,WAAU;;;;;;;;;;;;;;;;;YAKpB,UAAU,QAAQ,MAAM,GAAG,mBAC1B,kNAAC;gBAAG,WAAU;0BACX,QAAQ,GAAG,CAAC,CAAC,0BACZ,kNAAC;wBAEC,WAAU;wBACV,SAAS;4BACP,SAAS;4BACT,SAAS,GAAG,UAAU,UAAU,CAAC,CAAC,EAAE,UAAU,SAAS,EAAE;4BACzD,UAAU;wBACZ;kCAEA,cAAA,kNAAC;4BAAI,WAAU;;8CACb,kNAAC;;sDACC,kNAAC;4CAAI,WAAU;;gDACZ,UAAU,UAAU;gDAAC;gDAAE,UAAU,SAAS;;;;;;;sDAE7C,kNAAC;4CAAI,WAAU;sDAAiC,UAAU,WAAW;;;;;;;;;;;;8CAEvE,kNAAC;oCAAI,WAAU;8CACZ,UAAU,eAAe;;;;;;;;;;;;uBAhBzB,UAAU,EAAE;;;;;;;;;;YAwBxB,UAAU,MAAM,MAAM,IAAI,KAAK,CAAC,WAAW,QAAQ,MAAM,KAAK,mBAC7D,kNAAC;gBAAI,WAAU;;oBAAyH;oBACvG;oBAAM;;;;;;;;;;;;;AAK/C;GAxGwB;KAAA"}},
    {"offset": {"line": 1103, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/buddh/skytrips-admin/src/app/dashboard/booking/BookingModal.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { supabase } from \"@/lib/supabase\";\nimport AirportAutocomplete from \"@/components/AirportAutocomplete\";\nimport AirlineAutocomplete from \"@/components/AirlineAutocomplete\";\nimport CustomerSearch from \"@/components/CustomerSearch\";\nimport TravellerSearch from \"@/components/TravellerSearch\";\nimport countryData from \"../../../../libs/shared-utils/constants/country.json\";\nimport {\n  Booking,\n  Customer,\n  Traveller,\n  FlightItinerary,\n  FlightSegment,\n  Addons,\n} from \"@/types\";\n\ntype Agency = {\n  uid: string;\n  agency_name: string;\n  status: string;\n};\n\ninterface BookingModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSave: (booking: Partial<Booking>) => Promise<void>;\n  onEdit?: () => void;\n  booking: Booking | null;\n  isLoading: boolean;\n  isReadOnly?: boolean;\n}\n\ninterface Prices {\n  meals: string;\n  wheelchair: string;\n  pickup: string;\n  dropoff: string;\n  luggage: string;\n  [key: string]: string;\n}\n\ninterface FormData {\n  email: string;\n  phone: string;\n  travellers: Traveller[]; // Array of travellers\n  travellerFirstName: string; // Deprecated\n  travellerLastName: string; // Deprecated\n  passportNumber: string; // Deprecated\n  passportExpiry: string; // Deprecated\n  nationality: string; // Deprecated\n  dob: string; // Deprecated\n  tripType: string;\n  travelDate: string;\n  returnDate?: string;\n  origin: string;\n  destination: string;\n  transit: string;\n  airlines: string;\n  flightNumber: string;\n  flightClass: string;\n  frequentFlyer: string;\n  pnr: string;\n  ticketNumber: string;\n  issueMonth: string;\n  IssueDay: string;\n  issueYear: string;\n  agency: string;\n  handledBy: string;\n  status: string;\n  currency: string;\n  paymentStatus: string;\n  paymentMethod: string;\n  transactionId: string;\n  paymentDate: string;\n  buyingPrice: string;\n  costPrice: string;\n  sellingPrice: string;\n  payment: string;\n  stopoverLocation?: string;\n  stopoverArrival?: string;\n  stopoverDeparture?: string;\n  addons: Addons;\n  prices: Prices;\n  customerType: string;\n  contactType: string;\n  customerid?: string;\n  itineraries: FlightItinerary[];\n}\n\nexport default function BookingModal({\n  isOpen,\n  onClose,\n  onSave,\n  onEdit,\n  booking,\n  isLoading,\n  isReadOnly = false,\n}: BookingModalProps) {\n  const [isMealModalOpen, setIsMealModalOpen] = useState(false);\n  const [showStopover, setShowStopover] = useState(false);\n  const [searchingTravellerIndex, setSearchingTravellerIndex] = useState<\n    number | null\n  >(null);\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(\n    null,\n  );\n  const [agencies, setAgencies] = useState<Agency[]>([]);\n  const [agenciesLoading, setAgenciesLoading] = useState(false);\n  const [users, setUsers] = useState<any[]>([]);\n  const [usersLoading, setUsersLoading] = useState(false);\n\n  const [formData, setFormData] = useState<FormData>({\n    email: \"sarita.p@example.com\",\n    phone: \"+61 412 345 678\",\n    travellers: [],\n    travellerFirstName: \"\",\n    travellerLastName: \"\",\n    passportNumber: \"\",\n    passportExpiry: \"\",\n    nationality: \"Nepalese\",\n    dob: \"1985-03-15\",\n    tripType: \"One Way\",\n    travelDate: \"\",\n    returnDate: \"\",\n    origin: \"\",\n    destination: \"\",\n    transit: \"\",\n    airlines: \"\",\n    flightNumber: \"\",\n    flightClass: \"Economy\",\n    frequentFlyer: \"\",\n    pnr: \"\",\n    ticketNumber: \"\",\n    issueMonth: \"\",\n    IssueDay: \"\",\n    issueYear: \"\",\n    agency: \"SkyHigh Agency Ltd.\",\n    handledBy: \"John Doe\",\n    status: \"Confirmed\",\n    currency: \"USD\",\n    paymentStatus: \"Pending\",\n    paymentMethod: \"\",\n    transactionId: \"\",\n    paymentDate: \"\",\n    buyingPrice: \"0.00\",\n    costPrice: \"0.00\",\n    sellingPrice: \"0.00\",\n    payment: \"Pending\", // For backward compatibility\n    addons: {\n      meals: false,\n      wheelchair: false,\n      pickup: false,\n      dropoff: false,\n      luggage: false,\n    },\n    prices: {\n      meals: \"0.00\",\n      wheelchair: \"0.00\",\n      pickup: \"0.00\",\n      dropoff: \"0.00\",\n      luggage: \"0.00\",\n    },\n    customerType: \"existing\",\n    contactType: \"existing\",\n    itineraries: [\n      {\n        segments: [],\n      },\n    ],\n  });\n\n  useEffect(() => {\n    const loadAgencies = async () => {\n      setAgenciesLoading(true);\n      try {\n        const params = new URLSearchParams({\n          page: \"1\",\n          pageSize: \"100\",\n          q: \"\",\n          status: \"active\",\n          sortKey: \"agency_name\",\n          sortDir: \"asc\",\n        });\n        const res = await fetch(`/api/agencies?${params.toString()}`);\n        const j = await res.json();\n        if (!res.ok) {\n          console.error(\"Failed to load agencies\", j.error);\n          return;\n        }\n        setAgencies(j.data || []);\n      } catch (e) {\n        console.error(\"Failed to load agencies\", e);\n      } finally {\n        setAgenciesLoading(false);\n      }\n    };\n\n    const loadUsers = async () => {\n      setUsersLoading(true);\n      try {\n        const { data: rows, error } = await supabase\n          .from(\"users\")\n          .select(\"*\")\n          .order(\"created_at\", { ascending: false });\n\n        if (error) throw error;\n        setUsers(rows || []);\n      } catch (e) {\n        console.error(\"Failed to load users\", e);\n      } finally {\n        setUsersLoading(false);\n      }\n    };\n\n    loadAgencies();\n    loadUsers();\n  }, []);\n\n  const [travellerType, setTravellerType] = useState<\"existing\" | \"new\">(\"new\");\n\n  useEffect(() => {\n    if (booking) {\n      let loadedTravellers: Traveller[] = [];\n      if (\n        (booking as any).travellers &&\n        Array.isArray((booking as any).travellers) &&\n        (booking as any).travellers.length > 0\n      ) {\n        loadedTravellers = (booking as any).travellers.map((t: any) => ({\n          id: t.id || Date.now().toString() + Math.random().toString(),\n          firstName: t.firstName || t.first_name || \"\",\n          lastName: t.lastName || t.last_name || \"\",\n          passportNumber: t.passportNumber || t.passport_number || \"\",\n          passportExpiry: t.passportExpiry || t.passport_expiry || \"\",\n          dob: t.dob || \"\",\n          nationality: t.nationality || \"Nepalese\",\n          customerId: t.customerId || t.customer_id,\n          saveToDatabase: t.saveToDatabase || false,\n          eticketNumber: t.eticketNumber || t.eticket_number || \"\",\n        }));\n      } else {\n        // Fallback to flat fields\n        // loadedTravellers = [\n        //   {\n        //     id: Date.now().toString(),\n        //     firstName: booking.travellerFirstName || \"\",\n        //     lastName: booking.travellerLastName || \"\",\n        //     passportNumber: booking.passportNumber || \"\",\n        //     passportExpiry: booking.passportExpiry || \"\",\n        //     dob: booking.dob || \"\",\n        //     nationality: booking.nationality || \"Nepalese\",\n        //     eticketNumber: \"\",\n        //   },\n        // ];\n      }\n\n      setFormData((prev) => ({\n        ...prev,\n        ...booking,\n        travellers: loadedTravellers,\n        pnr: booking.PNR || prev.pnr,\n        // Ensure all fields are mapped\n        issueMonth: booking.issueMonth || \"\",\n        IssueDay: booking.IssueDay || \"\",\n        issueYear: booking.issueYear || \"\",\n        buyingPrice: booking.buyingPrice || \"0.00\",\n        payment: booking.payment || \"Pending\",\n        paymentDate: booking.dateofpayment || \"\",\n        customerType: (booking as any).customerType || \"existing\",\n        contactType: (booking as any).contactType || \"existing\",\n        addons: (booking as any).addons || prev.addons,\n        prices: (booking as any).prices || prev.prices,\n        stopoverLocation: booking.stopoverLocation || \"\",\n        agency: (booking as any).issuedthroughagency || booking.agency || \"N/A\",\n        customerid:\n          (booking as any).customerid ||\n          (booking as any).customerId ||\n          undefined,\n        returnDate: booking.returnDate || \"\",\n        itineraries: booking.itineraries || [{ segments: [] }],\n      }));\n      if ((booking as any).customer) {\n        setSelectedCustomer((booking as any).customer as unknown as Customer);\n      }\n      if (booking.stopoverLocation) {\n        setShowStopover(true);\n      }\n    } else {\n      // Reset for new booking\n      setFormData({\n        email: \"\",\n        phone: \"\",\n        travellers: [\n          {\n            id: Date.now().toString(),\n            firstName: \"\",\n            lastName: \"\",\n            passportNumber: \"\",\n            passportExpiry: \"\",\n            nationality: \"Australian\",\n            dob: \"\",\n            eticketNumber: \"\",\n          },\n        ],\n        travellerFirstName: \"\",\n        travellerLastName: \"\",\n        passportNumber: \"\",\n        passportExpiry: \"\",\n        nationality: \"Australian\",\n        dob: \"\",\n        tripType: \"One Way\",\n        travelDate: \"\",\n        returnDate: \"\",\n        origin: \"\",\n        destination: \"\",\n        transit: \"\",\n        airlines: \"\",\n        flightNumber: \"\",\n        flightClass: \"Economy\",\n        frequentFlyer: \"\",\n        pnr: \"\",\n        ticketNumber: \"\",\n        issueMonth: \"\",\n        IssueDay: \"\",\n        issueYear: \"\",\n        agency: \"SkyHigh Agency Ltd.\",\n        handledBy: \"\",\n        status: \"Confirmed\",\n        currency: \"USD\",\n        paymentStatus: \"Pending\",\n        paymentMethod: \"\",\n        transactionId: \"\",\n        paymentDate: \"\",\n        buyingPrice: \"0.00\",\n        costPrice: \"0.00\",\n        sellingPrice: \"0.00\",\n        payment: \"Pending\",\n        addons: {\n          meals: false,\n          wheelchair: false,\n          pickup: false,\n          dropoff: false,\n          luggage: false,\n        },\n        prices: {\n          meals: \"0.00\",\n          wheelchair: \"0.00\",\n          pickup: \"0.00\",\n          dropoff: \"0.00\",\n          luggage: \"0.00\",\n        },\n        customerType: \"existing\",\n        contactType: \"existing\",\n        customerid: undefined,\n        itineraries: [{ segments: [] }],\n      });\n      setShowStopover(false);\n    }\n  }, [booking, isOpen]);\n\n  if (!isOpen) return null;\n\n  const handleChange = (e: any) => {\n    if (isReadOnly) return;\n    const { name, value, type, checked } = e.target;\n\n    if (name === \"tripType\") {\n      let newItineraries = [...formData.itineraries];\n      if (value === \"Round Trip\" && newItineraries.length < 2) {\n        newItineraries.push({ segments: [] });\n      } else if (value === \"One Way\" && newItineraries.length > 1) {\n        newItineraries = [newItineraries[0]];\n      }\n      setFormData((prev) => ({\n        ...prev,\n        tripType: value,\n        itineraries: newItineraries,\n      }));\n      return;\n    }\n\n    if (type === \"checkbox\" && name.startsWith(\"addon-\")) {\n      const addonName = name.replace(\"addon-\", \"\") as keyof Addons;\n      setFormData((prev) => ({\n        ...prev,\n        addons: { ...prev.addons, [addonName]: checked },\n      }));\n    } else if (name.startsWith(\"price-\")) {\n      const priceName = name.replace(\"price-\", \"\");\n      setFormData((prev) => ({\n        ...prev,\n        prices: { ...prev.prices, [priceName]: value },\n      }));\n    } else {\n      setFormData((prev) => ({ ...prev, [name]: value }));\n    }\n  };\n\n  const calculateAddonsTotal = () => {\n    return Object.values(formData.prices || {})\n      .reduce((acc, price) => acc + (parseFloat(price) || 0), 0)\n      .toFixed(2);\n  };\n\n  const calculateGrandTotal = () => {\n    const sellingPrice = parseFloat(formData.sellingPrice) || 0;\n    const addonsTotal = parseFloat(calculateAddonsTotal()) || 0;\n    return (sellingPrice + addonsTotal).toFixed(2);\n  };\n\n  const handleCustomerSelect = (customer: Customer) => {\n    setSelectedCustomer(customer);\n    if (searchingTravellerIndex !== null) {\n      // Update specific traveller\n      setFormData((prev) => {\n        const newTravellers = [...prev.travellers];\n        if (!newTravellers[searchingTravellerIndex]) {\n          newTravellers[searchingTravellerIndex] = {\n            id: Date.now().toString(),\n            firstName: \"\",\n            lastName: \"\",\n          };\n        }\n        newTravellers[searchingTravellerIndex] = {\n          ...newTravellers[searchingTravellerIndex],\n          firstName: customer.firstName,\n          lastName: customer.lastName,\n          passportNumber: customer.passport?.number || \"\",\n          passportExpiry: customer.passport?.expiryDate || \"\",\n          dob: customer.dateOfBirth || \"\",\n          nationality: customer.country || \"Nepalese\",\n          customerId: customer.id,\n        };\n\n        const updates: any = { travellers: newTravellers };\n\n        // Sync primary if index 0\n        if (searchingTravellerIndex === 0) {\n          updates.travellerFirstName = customer.firstName;\n          updates.travellerLastName = customer.lastName;\n          updates.passportNumber = customer.passport?.number || \"\";\n          updates.passportExpiry = customer.passport?.expiryDate || \"\";\n          updates.dob = customer.dateOfBirth || \"\";\n          updates.nationality = customer.country || \"Nepalese\";\n\n          // Also sync contact info if needed\n          updates.email = prev.email || customer.email;\n          updates.phone = prev.phone || customer.phone;\n          updates.customerid = customer.id?.toString();\n          updates.customerType = \"existing\";\n        }\n\n        return { ...prev, ...updates };\n      });\n      setSearchingTravellerIndex(null);\n      return;\n    }\n\n    // Fallback for \"Existing Customer\" contact search (not traveller search)\n    setFormData((prev) => ({\n      ...prev,\n      // Common fields\n      email: customer.email || prev.email,\n      phone: customer.phone || prev.phone,\n      nationality: customer.country || prev.nationality,\n      customerid: customer.id?.toString(),\n\n      // Update traveller fields if we are in traveller selection mode OR if they match\n      travellerFirstName: customer.firstName || prev.travellerFirstName,\n      travellerLastName: customer.lastName || prev.travellerLastName,\n      passportNumber: customer.passport?.number || prev.passportNumber,\n      passportExpiry: customer.passport?.expiryDate || prev.passportExpiry,\n      dob: customer.dateOfBirth || prev.dob,\n\n      // Update first traveller in array too\n      travellers: prev.travellers.map((t, i) =>\n        i === 0\n          ? {\n              ...t,\n              firstName: customer.firstName,\n              lastName: customer.lastName,\n              passportNumber: customer.passport?.number || t.passportNumber,\n              passportExpiry: customer.passport?.expiryDate || t.passportExpiry,\n              dob: customer.dateOfBirth || t.dob,\n              nationality: customer.country || t.nationality,\n              customerId: customer.id,\n            }\n          : t,\n      ),\n    }));\n  };\n\n  const handleTravellerSelect = (traveller: any) => {\n    if (searchingTravellerIndex === null) return;\n\n    setFormData((prev) => {\n      const newTravellers = [...prev.travellers];\n      newTravellers[searchingTravellerIndex] = {\n        ...newTravellers[searchingTravellerIndex],\n        firstName: traveller.first_name,\n        lastName: traveller.last_name,\n        passportNumber: traveller.passport_number || \"\",\n        passportExpiry: traveller.passport_expiry || \"\",\n        dob: traveller.dob || \"\",\n        nationality: traveller.nationality || \"Nepalese\",\n        eticketNumber: \"\",\n      };\n\n      // Sync primary if index 0\n      const updates: any = { travellers: newTravellers };\n      if (searchingTravellerIndex === 0) {\n        updates.travellerFirstName = traveller.first_name;\n        updates.travellerLastName = traveller.last_name;\n        updates.passportNumber = traveller.passport_number || \"\";\n        updates.passportExpiry = traveller.passport_expiry || \"\";\n        updates.dob = traveller.dob || \"\";\n        updates.nationality = traveller.nationality || \"Nepalese\";\n      }\n\n      return { ...prev, ...updates };\n    });\n    setSearchingTravellerIndex(null);\n  };\n\n  const handleTravellerChange = (\n    index: number,\n    field: keyof Traveller,\n    value: any,\n  ) => {\n    setFormData((prev) => {\n      const newTravellers = [...prev.travellers];\n      newTravellers[index] = { ...newTravellers[index], [field]: value };\n\n      // Sync primary traveller (index 0) with flat fields\n      if (index === 0) {\n        const mapping: any = {\n          firstName: \"travellerFirstName\",\n          lastName: \"travellerLastName\",\n          passportNumber: \"passportNumber\",\n          passportExpiry: \"passportExpiry\",\n          dob: \"dob\",\n          nationality: \"nationality\",\n        };\n        if (mapping[field]) {\n          (prev as any)[mapping[field]] = value;\n        }\n      }\n      return { ...prev, travellers: newTravellers };\n    });\n  };\n\n  const addTraveller = () => {\n    setFormData((prev) => ({\n      ...prev,\n      travellers: [\n        ...prev.travellers,\n        {\n          id: Date.now().toString(),\n          firstName: \"\",\n          lastName: \"\",\n          passportNumber: \"\",\n          passportExpiry: \"\",\n          dob: \"\",\n          nationality: \"Nepalese\",\n          eticketNumber: \"\",\n        },\n      ],\n    }));\n  };\n\n  const removeTraveller = (index: number) => {\n    setFormData((prev) => {\n      if (prev.travellers.length <= 1) return prev;\n      const newTravellers = [...prev.travellers];\n      newTravellers.splice(index, 1);\n      return { ...prev, travellers: newTravellers };\n    });\n  };\n\n  const addSegment = (itineraryIndex: number) => {\n    setFormData((prev) => {\n      const newItineraries = [...prev.itineraries];\n      newItineraries[itineraryIndex].segments.push({\n        departure: { iataCode: \"\", at: \"\" },\n        arrival: { iataCode: \"\", at: \"\" },\n        carrierCode: \"\",\n        number: \"\",\n        duration: \"\",\n      });\n      return { ...prev, itineraries: newItineraries };\n    });\n  };\n\n  const removeSegment = (itineraryIndex: number, segmentIndex: number) => {\n    setFormData((prev) => {\n      const newItineraries = [...prev.itineraries];\n      newItineraries[itineraryIndex].segments.splice(segmentIndex, 1);\n      return { ...prev, itineraries: newItineraries };\n    });\n  };\n\n  const handleSegmentChange = (\n    itineraryIndex: number,\n    segmentIndex: number,\n    field: string,\n    value: any,\n    nestedField?: string,\n  ) => {\n    setFormData((prev) => {\n      const newItineraries = [...prev.itineraries];\n      const segment = newItineraries[itineraryIndex].segments[segmentIndex];\n\n      if (nestedField) {\n        // Handle nested fields like departure.iataCode\n        (segment as any)[field] = {\n          ...(segment as any)[field],\n          [nestedField]: value,\n        };\n      } else {\n        (segment as any)[field] = value;\n      }\n\n      return { ...prev, itineraries: newItineraries };\n    });\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (isReadOnly) return;\n\n    // Process new travellers to save to DB\n    for (const t of formData.travellers) {\n      if (t.saveToDatabase && t.firstName && t.lastName) {\n        try {\n          const { error } = await supabase.from(\"travellers\").insert({\n            first_name: t.firstName,\n            last_name: t.lastName,\n            passport_number: t.passportNumber,\n            passport_expiry: t.passportExpiry || null,\n            dob: t.dob || null,\n            nationality: t.nationality,\n          });\n          if (error) console.error(\"Error saving traveller:\", error);\n        } catch (err) {\n          console.error(\"Error processing traveller save:\", err);\n        }\n      }\n    }\n\n    // Validation: Ensure customer is selected if \"Existing\" is chosen\n    // if (formData.contactType === \"existing\" && !formData.customerid) {\n    //   alert(\"Please select an existing customer from the search results.\");\n    //   return;\n    // }\n\n    // Helper to convert empty strings to null for date fields\n    const toDateOrNull = (dateStr: string | undefined) => {\n      if (!dateStr || dateStr.trim() === \"\") return null;\n      return dateStr;\n    };\n\n    // Map back to the Booking interface structure before saving\n    const bookingToSave: Partial<Booking> = {\n      // Legacy flat fields removed to prevent usage\n      // travellerFirstName: ... // REMOVED\n      // travellerLastName: ...  // REMOVED\n\n      // Core booking fields\n      PNR: formData.pnr,\n      // ticketNumber: ... // REMOVED\n      airlines: formData.airlines,\n      travelDate: toDateOrNull(formData.travelDate),\n      departureDate: toDateOrNull(formData.travelDate),\n      returnDate: toDateOrNull(formData.returnDate),\n      itineraries: formData.itineraries,\n      origin: formData.origin,\n      transit: formData.transit,\n      destination: formData.destination,\n      tripType: formData.tripType,\n      issueMonth: formData.issueMonth || new Date().getMonth() + 1 + \"\",\n      IssueDay: formData.IssueDay || new Date().getDate() + \"\",\n      issueYear: formData.issueYear || new Date().getFullYear() + \"\",\n      buyingPrice: formData.buyingPrice,\n      sellingPrice: formData.sellingPrice,\n      payment: formData.paymentStatus,\n      status: formData.status,\n\n      // Re-enabled fields as columns are added to DB\n      email: formData.email,\n      phone: formData.phone,\n\n      // Passport info - prefer travellers array but keep flat if needed for some legacy view\n      passportNumber:\n        formData.travellers[0]?.passportNumber || formData.passportNumber,\n      passportExpiry: toDateOrNull(\n        formData.travellers[0]?.passportExpiry || formData.passportExpiry,\n      ),\n      nationality: formData.travellers[0]?.nationality || formData.nationality,\n      dob: toDateOrNull(formData.dob),\n\n      flightNumber: formData.flightNumber,\n      flightClass: formData.flightClass,\n      frequentFlyer: formData.frequentFlyer,\n      issuedthroughagency: formData.agency,\n      handledBy: formData.handledBy,\n      paymentStatus: formData.paymentStatus,\n      paymentMethod: formData.paymentMethod,\n      transactionId: formData.transactionId,\n      dateofpayment: toDateOrNull(formData.paymentDate), // Mapped to correct DB column\n      stopoverLocation: formData.stopoverLocation,\n      customerid: formData.customerid,\n      travellers: formData.travellers, // The Source of Truth\n      customer: selectedCustomer || undefined,\n\n      // Custom fields\n      customerType: formData.customerType,\n      contactType: formData.contactType,\n      addons: formData.addons,\n      prices: formData.prices,\n    };\n    onSave(bookingToSave);\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center overflow-hidden\">\n      {/* Backdrop */}\n      <div\n        className=\"absolute inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity\"\n        onClick={onClose}\n      ></div>\n\n      {/* Modal Container */}\n      <div className=\"relative bg-white w-full max-w-6xl h-[90vh] flex flex-col rounded-xl shadow-2xl overflow-hidden border border-gray-200 mx-4\">\n        {/* Header */}\n        <header className=\"bg-white shadow-sm border-b border-gray-200 h-16 flex items-center justify-between px-6 lg:px-8 z-10 shrink-0\">\n          <div>\n            <h1 className=\"text-lg font-semibold text-gray-900\">\n              {booking ? \"Edit Booking\" : \"New Booking\"}\n            </h1>\n            <p className=\"text-xs text-gray-500\">\n              {booking\n                ? `Manage details for Booking #${booking.id}`\n                : \"Enter new booking details\"}\n            </p>\n          </div>\n          <div className=\"flex items-center gap-4\">\n            <button\n              onClick={onClose}\n              className=\"p-2 text-gray-400 hover:text-gray-500 transition-colors\"\n            >\n              <span className=\"material-symbols-outlined text-2xl\">close</span>\n            </button>\n          </div>\n        </header>\n\n        {/* Main Content (Scrollable) */}\n        <div className=\"flex-1 overflow-y-auto bg-gray-50\">\n          <main className=\"p-6 lg:p-8\">\n            <form onSubmit={handleSubmit}>\n              <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n                {/* Left Columns (Main Form) */}\n                <div className=\"lg:col-span-2 space-y-6\">\n                  {/* Customer Contact Details */}\n                  <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden transition-all hover:shadow-md\">\n                    <div className=\"px-8 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50\">\n                      <h3 className=\"text-lg font-bold text-slate-900 flex items-center tracking-tight\">\n                        <span className=\"material-symbols-outlined text-primary mr-3\">\n                          contact_mail\n                        </span>\n                        Customer Contact Details\n                      </h3>\n                    </div>\n                    <div className=\"p-8\">\n                      <div className=\"mb-8 p-6 bg-slate-50/50 rounded-xl border border-slate-100\">\n                        <div className=\"flex flex-col sm:flex-row sm:items-center gap-6\">\n                          <div className=\"flex items-center gap-4 w-full sm:w-auto\">\n                            <div className=\"flex items-center h-6\">\n                              <input\n                                checked={formData.contactType === \"existing\"}\n                                onChange={() =>\n                                  setFormData((prev) => ({\n                                    ...prev,\n                                    contactType: \"existing\",\n                                  }))\n                                }\n                                className=\"focus:ring-primary h-5 w-5 text-primary border-slate-300 cursor-pointer\"\n                                id=\"existing-contact\"\n                                name=\"contact-type\"\n                                type=\"radio\"\n                                value=\"existing\"\n                              />\n                            </div>\n                            <label\n                              className=\"font-bold text-slate-700 text-sm whitespace-nowrap cursor-pointer hover:text-slate-900\"\n                              htmlFor=\"existing-contact\"\n                            >\n                              Existing Customer\n                            </label>\n                          </div>\n                          <div className=\"flex items-center gap-4 w-full sm:w-auto\">\n                            <div className=\"flex items-center h-6\">\n                              <input\n                                checked={formData.contactType === \"new\"}\n                                onChange={() =>\n                                  setFormData((prev) => ({\n                                    ...prev,\n                                    contactType: \"new\",\n                                  }))\n                                }\n                                className=\"focus:ring-primary h-5 w-5 text-primary border-slate-300 cursor-pointer\"\n                                id=\"new-contact\"\n                                name=\"contact-type\"\n                                type=\"radio\"\n                                value=\"new\"\n                              />\n                            </div>\n                            <label\n                              className=\"font-bold text-slate-700 text-sm whitespace-nowrap cursor-pointer hover:text-slate-900\"\n                              htmlFor=\"new-contact\"\n                            >\n                              New Customer\n                            </label>\n                          </div>\n                        </div>\n\n                        {formData.contactType === \"existing\" && (\n                          <div className=\"w-full mt-6 relative\">\n                            <CustomerSearch\n                              onSelect={handleCustomerSelect}\n                              className=\"w-full\"\n                            />\n                          </div>\n                        )}\n                      </div>\n\n                      {formData.contactType === \"new\" && (\n                        <div className=\"space-y-6\">\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                            <div>\n                              <label\n                                className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\"\n                                htmlFor=\"travellerFirstName\"\n                              >\n                                First Name\n                              </label>\n                              <div className=\"relative rounded-lg shadow-sm\">\n                                <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4\">\n                                  <span\n                                    className=\"material-symbols-outlined text-slate-400\"\n                                    style={{ fontSize: \"20px\" }}\n                                  >\n                                    person\n                                  </span>\n                                </div>\n                                <input\n                                  className=\"block w-full h-12 rounded-lg border-slate-200 pl-11 focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium uppercase\"\n                                  id=\"travellerFirstName\"\n                                  name=\"travellerFirstName\"\n                                  type=\"text\"\n                                  value={formData.travellerFirstName}\n                                  onChange={handleChange}\n                                  placeholder=\"Given Name\"\n                                  disabled={isReadOnly}\n                                />\n                              </div>\n                            </div>\n                            <div>\n                              <label\n                                className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\"\n                                htmlFor=\"travellerLastName\"\n                              >\n                                Last Name\n                              </label>\n                              <div className=\"relative rounded-lg shadow-sm\">\n                                <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4\">\n                                  <span\n                                    className=\"material-symbols-outlined text-slate-400\"\n                                    style={{ fontSize: \"20px\" }}\n                                  >\n                                    person\n                                  </span>\n                                </div>\n                                <input\n                                  className=\"block w-full h-12 rounded-lg border-slate-200 pl-11 focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium uppercase\"\n                                  id=\"travellerLastName\"\n                                  name=\"travellerLastName\"\n                                  type=\"text\"\n                                  value={formData.travellerLastName}\n                                  onChange={handleChange}\n                                  placeholder=\"Surname\"\n                                  disabled={isReadOnly}\n                                />\n                              </div>\n                            </div>\n                          </div>\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                            <div>\n                              <label\n                                className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\"\n                                htmlFor=\"email\"\n                              >\n                                Email Address\n                              </label>\n                              <div className=\"relative rounded-lg shadow-sm\">\n                                <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4\">\n                                  <span\n                                    className=\"material-symbols-outlined text-slate-400\"\n                                    style={{ fontSize: \"20px\" }}\n                                  >\n                                    email\n                                  </span>\n                                </div>\n                                <input\n                                  className=\"block w-full h-12 rounded-lg border-slate-200 pl-11 focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium\"\n                                  id=\"email\"\n                                  name=\"email\"\n                                  type=\"email\"\n                                  value={formData.email}\n                                  onChange={handleChange}\n                                  placeholder=\"customer@email.com\"\n                                  disabled={isReadOnly}\n                                />\n                              </div>\n                            </div>\n                            <div>\n                              <label\n                                className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\"\n                                htmlFor=\"phone\"\n                              >\n                                Phone Number\n                              </label>\n                              <div className=\"relative rounded-lg shadow-sm\">\n                                <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4\">\n                                  <span\n                                    className=\"material-symbols-outlined text-slate-400\"\n                                    style={{ fontSize: \"20px\" }}\n                                  >\n                                    phone\n                                  </span>\n                                </div>\n                                <input\n                                  className=\"block w-full h-12 rounded-lg border-slate-200 pl-11 focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium\"\n                                  id=\"phone\"\n                                  name=\"phone\"\n                                  type=\"tel\"\n                                  value={formData.phone}\n                                  onChange={handleChange}\n                                  placeholder=\"+61 XXX XXX XXX\"\n                                  disabled={isReadOnly}\n                                />\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Traveller Information */}\n                  <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden transition-all hover:shadow-md\">\n                    <div className=\"px-8 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50\">\n                      <h3 className=\"text-lg font-bold text-slate-900 flex items-center tracking-tight\">\n                        <span className=\"material-symbols-outlined text-primary mr-3\">\n                          person\n                        </span>\n                        Traveller Information\n                      </h3>\n                    </div>\n                    <div className=\"p-8\">\n                      {formData.travellers.map((traveller, index) => (\n                        <div\n                          key={traveller.id || index}\n                          className=\"mb-8 p-6 bg-slate-50/50 rounded-xl border border-slate-100 relative group\"\n                        >\n                          <div className=\"flex justify-between items-center mb-6\">\n                            <h4 className=\"font-bold text-slate-800 text-lg flex items-center gap-2\">\n                              <span className=\"flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-600 text-sm\">\n                                {index + 1}\n                              </span>\n                              Traveller Details\n                            </h4>\n                            <div className=\"flex gap-2\">\n                              {formData.travellers.length > 1 && (\n                                <button\n                                  type=\"button\"\n                                  onClick={() => removeTraveller(index)}\n                                  className=\"text-xs bg-red-50 text-red-600 px-3 py-1.5 rounded-lg font-bold hover:bg-red-100 flex items-center gap-1\"\n                                >\n                                  <span className=\"material-symbols-outlined text-[16px]\">\n                                    delete\n                                  </span>\n                                  Remove\n                                </button>\n                              )}\n                            </div>\n                          </div>\n\n                          <div className=\"mb-6 p-4 bg-slate-50 rounded-xl border border-slate-200\">\n                            <div className=\"flex flex-col sm:flex-row sm:items-center gap-6\">\n                              <div className=\"flex items-center gap-4 w-full sm:w-auto\">\n                                <div className=\"flex items-center h-6\">\n                                  <input\n                                    checked={travellerType === \"existing\"}\n                                    onChange={() => {\n                                      setTravellerType(\"existing\");\n                                      setSearchingTravellerIndex(index);\n                                    }}\n                                    className=\"focus:ring-primary h-5 w-5 text-primary border-slate-300 cursor-pointer\"\n                                    id={`existing-traveller-${index}`}\n                                    name={`traveller-type-${index}`}\n                                    type=\"radio\"\n                                    value=\"existing\"\n                                  />\n                                </div>\n                                <label\n                                  className=\"font-bold text-slate-700 text-sm whitespace-nowrap cursor-pointer hover:text-slate-900\"\n                                  htmlFor={`existing-traveller-${index}`}\n                                >\n                                  Existing Traveller\n                                </label>\n                              </div>\n                              <div className=\"flex items-center gap-4 w-full sm:w-auto\">\n                                <div className=\"flex items-center h-6\">\n                                  <input\n                                    checked={travellerType === \"new\"}\n                                    onChange={() => {\n                                      setTravellerType(\"new\");\n                                      setSearchingTravellerIndex(null);\n                                    }}\n                                    className=\"focus:ring-primary h-5 w-5 text-primary border-slate-300 cursor-pointer\"\n                                    id={`new-traveller-${index}`}\n                                    name={`traveller-type-${index}`}\n                                    type=\"radio\"\n                                    value=\"new\"\n                                  />\n                                </div>\n                                <label\n                                  className=\"font-bold text-slate-700 text-sm whitespace-nowrap cursor-pointer hover:text-slate-900\"\n                                  htmlFor={`new-traveller-${index}`}\n                                >\n                                  New Traveller\n                                </label>\n                              </div>\n                            </div>\n                          </div>\n\n                          {travellerType === \"existing\" && (\n                            <div className=\"mb-4 animate-in fade-in slide-in-from-top-2 duration-200 bg-white p-4 rounded-xl border border-blue-100 shadow-sm\">\n                              <label className=\"block text-xs font-bold text-slate-700 uppercase tracking-widest mb-2\">\n                                Search Existing Traveller\n                              </label>\n                              <TravellerSearch\n                                onSelect={(t) => {\n                                  handleTravellerSelect(t);\n                                }}\n                              />\n                              <p className=\"text-xs text-slate-500 mt-2\">\n                                Select a traveller to auto-fill their details.\n                              </p>\n                            </div>\n                          )}\n\n                          {(travellerType === \"new\" ||\n                            (travellerType === \"existing\" &&\n                              traveller.firstName)) && (\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                              <div className=\"col-span-1\">\n                                <label className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\">\n                                  First Name\n                                </label>\n                                <input\n                                  className=\"block w-full h-12 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium pl-4 uppercase\"\n                                  value={traveller.firstName}\n                                  onChange={(e) =>\n                                    handleTravellerChange(\n                                      index,\n                                      \"firstName\",\n                                      e.target.value,\n                                    )\n                                  }\n                                  disabled={isReadOnly}\n                                  placeholder=\"Given Name\"\n                                />\n                              </div>\n                              <div className=\"col-span-1\">\n                                <label className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\">\n                                  Last Name\n                                </label>\n                                <input\n                                  className=\"block w-full h-12 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium pl-4 uppercase\"\n                                  value={traveller.lastName}\n                                  onChange={(e) =>\n                                    handleTravellerChange(\n                                      index,\n                                      \"lastName\",\n                                      e.target.value,\n                                    )\n                                  }\n                                  disabled={isReadOnly}\n                                  placeholder=\"Surname\"\n                                />\n                              </div>\n                              <div className=\"col-span-1 md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-8 p-6 bg-slate-50/50 rounded-xl border border-slate-100\">\n                                <div>\n                                  <label className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\">\n                                    Passport Number\n                                  </label>\n                                  <div className=\"relative rounded-lg shadow-sm\">\n                                    <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4\">\n                                      <span\n                                        className=\"material-symbols-outlined text-slate-400\"\n                                        style={{ fontSize: \"20px\" }}\n                                      >\n                                        badge\n                                      </span>\n                                    </div>\n                                    <input\n                                      className=\"block w-full h-12 rounded-lg border-slate-200 pl-11 focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium uppercase\"\n                                      value={traveller.passportNumber || \"\"}\n                                      onChange={(e) =>\n                                        handleTravellerChange(\n                                          index,\n                                          \"passportNumber\",\n                                          e.target.value,\n                                        )\n                                      }\n                                      disabled={isReadOnly}\n                                      placeholder=\"e.g. A1234567X\"\n                                    />\n                                  </div>\n                                </div>\n                                <div>\n                                  <label className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\">\n                                    Passport Expiry Date\n                                  </label>\n                                  <input\n                                    className=\"block w-full h-12 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium px-4\"\n                                    type=\"date\"\n                                    value={traveller.passportExpiry || \"\"}\n                                    onChange={(e) =>\n                                      handleTravellerChange(\n                                        index,\n                                        \"passportExpiry\",\n                                        e.target.value,\n                                      )\n                                    }\n                                    disabled={isReadOnly}\n                                  />\n                                </div>\n                              </div>\n                              <div className=\"col-span-1 md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-8 p-6 bg-slate-50/50 rounded-xl border border-slate-100\">\n                                <div>\n                                  <label className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\">\n                                    Nationality\n                                  </label>\n                                  <select\n                                    className=\"block w-full h-12 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium px-4\"\n                                    value={traveller.nationality || \"Nepalese\"}\n                                    onChange={(e) =>\n                                      handleTravellerChange(\n                                        index,\n                                        \"nationality\",\n                                        e.target.value,\n                                      )\n                                    }\n                                    disabled={isReadOnly}\n                                  >\n                                    {countryData.countries.map((c) => (\n                                      <option key={c.value} value={c.label}>\n                                        {c.label}\n                                      </option>\n                                    ))}\n                                  </select>\n                                </div>\n                                <div>\n                                  <label className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\">\n                                    Date of Birth\n                                  </label>\n                                  <input\n                                    className=\"block w-full h-12 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium px-4\"\n                                    type=\"date\"\n                                    value={traveller.dob || \"\"}\n                                    onChange={(e) =>\n                                      handleTravellerChange(\n                                        index,\n                                        \"dob\",\n                                        e.target.value,\n                                      )\n                                    }\n                                    disabled={isReadOnly}\n                                  />\n                                </div>\n                                <div>\n                                  <label className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\">\n                                    E-Ticket Number\n                                  </label>\n                                  <div className=\"relative rounded-lg shadow-sm\">\n                                    <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4\">\n                                      <span\n                                        className=\"material-symbols-outlined text-slate-400\"\n                                        style={{ fontSize: \"20px\" }}\n                                      >\n                                        confirmation_number\n                                      </span>\n                                    </div>\n                                    <input\n                                      className=\"block w-full h-12 rounded-lg border-slate-200 pl-11 focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium\"\n                                      value={traveller.eticketNumber || \"\"}\n                                      onChange={(e) =>\n                                        handleTravellerChange(\n                                          index,\n                                          \"eticketNumber\",\n                                          e.target.value,\n                                        )\n                                      }\n                                      disabled={isReadOnly}\n                                      placeholder=\"E-Ticket No.\"\n                                    />\n                                  </div>\n                                </div>\n                                <label className=\"flex items-start gap-3 cursor-pointer group p-3 rounded-lg hover:bg-slate-50 transition-colors border border-transparent hover:border-slate-100\">\n                                  <div className=\"flex items-center h-5 mt-0.5\">\n                                    <input\n                                      type=\"checkbox\"\n                                      className=\"w-4 h-4 text-primary border-slate-300 rounded focus:ring-primary cursor-pointer\"\n                                      checked={\n                                        traveller.saveToDatabase || false\n                                      }\n                                      onChange={(e) =>\n                                        handleTravellerChange(\n                                          index,\n                                          \"saveToDatabase\",\n                                          e.target.checked,\n                                        )\n                                      }\n                                      disabled={isReadOnly}\n                                    />\n                                  </div>\n                                  <div>\n                                    <span className=\"text-sm font-bold text-slate-700 group-hover:text-primary transition-colors\">\n                                      Save to Travellers Database\n                                    </span>\n                                    <p className=\"text-xs text-slate-500 mt-0.5\">\n                                      Add this person to your saved travellers\n                                      list for future bookings.\n                                    </p>\n                                  </div>\n                                </label>\n                              </div>\n                            </div>\n                          )}\n                        </div>\n                      ))}\n\n                      <button\n                        type=\"button\"\n                        onClick={addTraveller}\n                        className=\"w-full py-4 border-2 border-dashed border-slate-300 rounded-xl text-slate-500 font-bold hover:border-primary hover:text-primary hover:bg-blue-50/50 transition-all flex items-center justify-center gap-2\"\n                      >\n                        <span className=\"material-symbols-outlined\">\n                          person_add\n                        </span>\n                        Add Another Traveller\n                      </button>\n                    </div>\n                  </div>\n\n                  {/* Route & Trip Details */}\n                  <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden transition-all hover:shadow-md\">\n                    <div className=\"px-8 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50\">\n                      <h3 className=\"text-lg font-bold text-slate-900 flex items-center tracking-tight\">\n                        <span className=\"material-symbols-outlined text-primary mr-3\">\n                          flight_takeoff\n                        </span>\n                        Route & Trip Details\n                      </h3>\n                    </div>\n                    <div className=\"p-8\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8\">\n                        <div>\n                          <label className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\">\n                            Trip Type\n                          </label>\n                          <select\n                            className=\"block w-full h-12 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium px-4\"\n                            name=\"tripType\"\n                            value={formData.tripType}\n                            onChange={handleChange}\n                            disabled={isReadOnly}\n                          >\n                            <option>One Way</option>\n                            <option>Round Trip</option>\n                            <option>Multi City</option>\n                          </select>\n                        </div>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                          <div>\n                            <label className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\">\n                              Departure Date\n                            </label>\n                            <input\n                              className=\"block w-full h-12 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium px-4\"\n                              name=\"travelDate\"\n                              type=\"date\"\n                              value={formData.travelDate}\n                              onChange={handleChange}\n                              disabled={isReadOnly}\n                            />\n                          </div>\n                          {formData.tripType === \"Round Trip\" && (\n                            <div>\n                              <label className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\">\n                                Return Date\n                              </label>\n                              <input\n                                className=\"block w-full h-12 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium px-4\"\n                                name=\"returnDate\"\n                                type=\"date\"\n                                value={formData.returnDate}\n                                onChange={handleChange}\n                                disabled={isReadOnly}\n                              />\n                            </div>\n                          )}\n                        </div>\n                        <div>\n                          <AirportAutocomplete\n                            label=\"Origin (From)\"\n                            name=\"origin\"\n                            value={formData.origin}\n                            onChange={handleChange}\n                            disabled={isReadOnly}\n                            icon=\"flight_takeoff\"\n                          />\n                        </div>\n                        <div>\n                          <AirportAutocomplete\n                            label=\"Destination (To)\"\n                            name=\"destination\"\n                            value={formData.destination}\n                            onChange={handleChange}\n                            disabled={isReadOnly}\n                            icon=\"flight_land\"\n                          />\n                        </div>\n                      </div>\n\n                      {/* Detailed Itinerary Segments */}\n                      <div className=\"space-y-6\">\n                        {formData.itineraries?.map((itinerary, itinIndex) => (\n                          <div\n                            key={itinIndex}\n                            className=\"bg-slate-50 border border-slate-200 rounded-xl p-6\"\n                          >\n                            <div className=\"flex justify-between items-center mb-4\">\n                              <h4 className=\"text-sm font-bold text-slate-800 uppercase tracking-wider\">\n                                {itinIndex === 0\n                                  ? \"Outbound Flight Segments\"\n                                  : \"Return Flight Segments\"}\n                              </h4>\n                            </div>\n\n                            <div className=\"space-y-4\">\n                              {itinerary.segments.map((segment, segIndex) => (\n                                <div\n                                  key={segIndex}\n                                  className=\"bg-white p-4 rounded-lg border border-slate-200 shadow-sm relative group\"\n                                >\n                                  <button\n                                    type=\"button\"\n                                    onClick={() =>\n                                      removeSegment(itinIndex, segIndex)\n                                    }\n                                    className=\"absolute top-2 right-2 text-slate-400 hover:text-red-500\"\n                                  >\n                                    <span className=\"material-symbols-outlined text-lg\">\n                                      delete\n                                    </span>\n                                  </button>\n\n                                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4\">\n                                    {/* Departure */}\n                                    <div className=\"col-span-1 md:col-span-2\">\n                                      <label className=\"text-xs font-bold text-slate-500 uppercase\">\n                                        Departure\n                                      </label>\n                                      <div className=\"grid grid-cols-3 gap-2 mt-1\">\n                                        <input\n                                          placeholder=\"IATA\"\n                                          className=\"block w-full rounded-md border-slate-200 text-sm\"\n                                          value={segment.departure?.iataCode}\n                                          onChange={(e) =>\n                                            handleSegmentChange(\n                                              itinIndex,\n                                              segIndex,\n                                              \"departure\",\n                                              e.target.value,\n                                              \"iataCode\",\n                                            )\n                                          }\n                                        />\n                                        <input\n                                          placeholder=\"Terminal\"\n                                          className=\"block w-full rounded-md border-slate-200 text-sm\"\n                                          value={segment.departure?.terminal}\n                                          onChange={(e) =>\n                                            handleSegmentChange(\n                                              itinIndex,\n                                              segIndex,\n                                              \"departure\",\n                                              e.target.value,\n                                              \"terminal\",\n                                            )\n                                          }\n                                        />\n                                        <input\n                                          type=\"datetime-local\"\n                                          className=\"block w-full rounded-md border-slate-200 text-sm\"\n                                          value={segment.departure?.at}\n                                          onChange={(e) =>\n                                            handleSegmentChange(\n                                              itinIndex,\n                                              segIndex,\n                                              \"departure\",\n                                              e.target.value,\n                                              \"at\",\n                                            )\n                                          }\n                                        />\n                                      </div>\n                                    </div>\n\n                                    {/* Arrival */}\n                                    <div className=\"col-span-1 md:col-span-2\">\n                                      <label className=\"text-xs font-bold text-slate-500 uppercase\">\n                                        Arrival\n                                      </label>\n                                      <div className=\"grid grid-cols-3 gap-2 mt-1\">\n                                        <input\n                                          placeholder=\"IATA\"\n                                          className=\"block w-full rounded-md border-slate-200 text-sm\"\n                                          value={segment.arrival?.iataCode}\n                                          onChange={(e) =>\n                                            handleSegmentChange(\n                                              itinIndex,\n                                              segIndex,\n                                              \"arrival\",\n                                              e.target.value,\n                                              \"iataCode\",\n                                            )\n                                          }\n                                        />\n                                        <input\n                                          placeholder=\"Terminal\"\n                                          className=\"block w-full rounded-md border-slate-200 text-sm\"\n                                          value={segment.arrival?.terminal}\n                                          onChange={(e) =>\n                                            handleSegmentChange(\n                                              itinIndex,\n                                              segIndex,\n                                              \"arrival\",\n                                              e.target.value,\n                                              \"terminal\",\n                                            )\n                                          }\n                                        />\n                                        <input\n                                          type=\"datetime-local\"\n                                          className=\"block w-full rounded-md border-slate-200 text-sm\"\n                                          value={segment.arrival?.at}\n                                          onChange={(e) =>\n                                            handleSegmentChange(\n                                              itinIndex,\n                                              segIndex,\n                                              \"arrival\",\n                                              e.target.value,\n                                              \"at\",\n                                            )\n                                          }\n                                        />\n                                      </div>\n                                    </div>\n                                  </div>\n\n                                  <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                                    <div>\n                                      <label className=\"text-xs font-bold text-slate-500 uppercase\">\n                                        Carrier\n                                      </label>\n                                      <input\n                                        placeholder=\"Code (e.g. QF)\"\n                                        className=\"block w-full mt-1 rounded-md border-slate-200 text-sm\"\n                                        value={segment.carrierCode}\n                                        onChange={(e) =>\n                                          handleSegmentChange(\n                                            itinIndex,\n                                            segIndex,\n                                            \"carrierCode\",\n                                            e.target.value,\n                                          )\n                                        }\n                                      />\n                                    </div>\n                                    <div>\n                                      <label className=\"text-xs font-bold text-slate-500 uppercase\">\n                                        Flight No.\n                                      </label>\n                                      <input\n                                        placeholder=\"Number\"\n                                        className=\"block w-full mt-1 rounded-md border-slate-200 text-sm\"\n                                        value={segment.number}\n                                        onChange={(e) =>\n                                          handleSegmentChange(\n                                            itinIndex,\n                                            segIndex,\n                                            \"number\",\n                                            e.target.value,\n                                          )\n                                        }\n                                      />\n                                    </div>\n                                    <div>\n                                      <label className=\"text-xs font-bold text-slate-500 uppercase\">\n                                        Aircraft\n                                      </label>\n                                      <input\n                                        placeholder=\"Code\"\n                                        className=\"block w-full mt-1 rounded-md border-slate-200 text-sm\"\n                                        value={segment.aircraft?.code}\n                                        onChange={(e) =>\n                                          handleSegmentChange(\n                                            itinIndex,\n                                            segIndex,\n                                            \"aircraft\",\n                                            e.target.value,\n                                            \"code\",\n                                          )\n                                        }\n                                      />\n                                    </div>\n                                    <div>\n                                      <label className=\"text-xs font-bold text-slate-500 uppercase\">\n                                        Duration\n                                      </label>\n                                      <input\n                                        placeholder=\"PTxxHxxM\"\n                                        className=\"block w-full mt-1 rounded-md border-slate-200 text-sm\"\n                                        value={segment.duration}\n                                        onChange={(e) =>\n                                          handleSegmentChange(\n                                            itinIndex,\n                                            segIndex,\n                                            \"duration\",\n                                            e.target.value,\n                                          )\n                                        }\n                                      />\n                                    </div>\n                                  </div>\n                                </div>\n                              ))}\n                              <button\n                                type=\"button\"\n                                onClick={() => addSegment(itinIndex)}\n                                className=\"w-full py-3 border-2 border-dashed border-slate-300 rounded-lg text-slate-500 font-bold hover:border-primary hover:text-primary hover:bg-blue-50/50 transition-all flex items-center justify-center gap-2 text-sm\"\n                              >\n                                <span className=\"material-symbols-outlined text-lg\">\n                                  add\n                                </span>\n                                Add Flight Segment\n                              </button>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n\n                      <div className=\"mt-8 pt-6 border-t border-slate-100\">\n                        <div className=\"flex justify-between items-center mb-6\">\n                          <h4 className=\"text-xs font-black text-slate-400 uppercase tracking-[0.2em]\">\n                            Global Flight Details\n                          </h4>\n                        </div>\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n                          <div className=\"md:col-span-1\">\n                            <AirlineAutocomplete\n                              label=\"Primary Airline\"\n                              name=\"airlines\"\n                              value={formData.airlines}\n                              onChange={handleChange}\n                              disabled={isReadOnly}\n                              icon=\"airlines\"\n                            />\n                          </div>\n                          <div className=\"md:col-span-1\">\n                            <label className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\">\n                              Class\n                            </label>\n                            <select\n                              className=\"block w-full h-12 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium px-4\"\n                              name=\"flightClass\"\n                              value={formData.flightClass}\n                              onChange={handleChange}\n                              disabled={isReadOnly}\n                            >\n                              <option>Economy</option>\n                              <option>Premium Economy</option>\n                              <option>Business</option>\n                              <option>First Class</option>\n                            </select>\n                          </div>\n                        </div>\n                      </div>\n\n                      <div className=\"mt-6\">\n                        <div className=\"p-3 bg-blue-50 border border-blue-100 rounded-md flex items-start gap-3\">\n                          <span className=\"material-symbols-outlined text-blue-500 mt-0.5\">\n                            info\n                          </span>\n                          <div>\n                            <p className=\"text-sm text-blue-800 font-medium\">\n                              Itinerary Modification\n                            </p>\n                            <p className=\"text-xs text-blue-600 mt-0.5\">\n                              Changing origin, destination, or dates may affect\n                              pricing. Ensure to re-calculate fares after\n                              modifying the itinerary.\n                            </p>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Add-ons & Services */}\n                  <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden transition-all hover:shadow-md\">\n                    <div className=\"px-8 py-5 border-b border-slate-100 bg-slate-50/50\">\n                      <h3 className=\"text-lg font-bold text-slate-900 flex items-center tracking-tight\">\n                        <span className=\"material-symbols-outlined text-primary mr-3\">\n                          extension\n                        </span>\n                        Add-ons & Services\n                      </h3>\n                    </div>\n                    <div className=\"p-8\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-10\">\n                        <div className=\"space-y-6\">\n                          <h4 className=\"text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-6\">\n                            Ancillary Services\n                          </h4>\n                          <div className=\"flex items-center justify-between p-4 bg-slate-50/50 rounded-xl border border-slate-100\">\n                            <div className=\"flex items-center\">\n                              <label className=\"flex items-center space-x-4 cursor-pointer group\">\n                                <input\n                                  className=\"h-5 w-5 text-primary border-slate-300 rounded focus:ring-primary transition-all cursor-pointer\"\n                                  type=\"checkbox\"\n                                  name=\"addon-meals\"\n                                  checked={formData.addons.meals}\n                                  onChange={handleChange}\n                                />\n                                <span className=\"text-sm font-bold text-slate-700 group-hover:text-primary transition-colors\">\n                                  Meals\n                                </span>\n                              </label>\n                              <button\n                                type=\"button\"\n                                onClick={() => setIsMealModalOpen(true)}\n                                className=\"ml-4 text-xs font-bold text-primary hover:text-blue-700 cursor-pointer flex items-center gap-1.5 transition-colors px-2 py-1 bg-blue-50 rounded-md\"\n                              >\n                                <span className=\"material-symbols-outlined text-base\">\n                                  tune\n                                </span>\n                                Options\n                              </button>\n                            </div>\n                            <div className=\"relative w-32\">\n                              <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3\">\n                                <span className=\"text-slate-400 font-bold sm:text-xs\">\n                                  $\n                                </span>\n                              </div>\n                              <input\n                                className=\"block w-full h-10 rounded-lg border-slate-200 pl-7 text-right focus:border-primary focus:ring focus:ring-primary/10 sm:text-sm font-bold text-slate-700\"\n                                name=\"price-meals\"\n                                value={formData.prices?.meals || \"\"}\n                                onChange={handleChange}\n                                placeholder=\"0.00\"\n                                type=\"number\"\n                              />\n                            </div>\n                          </div>\n                          {/* Simplified remaining addons */}\n                          <div className=\"flex items-center justify-between p-4 bg-slate-50/50 rounded-xl border border-slate-100\">\n                            <label className=\"flex items-center space-x-4 cursor-pointer group\">\n                              <input\n                                className=\"h-5 w-5 text-primary border-slate-300 rounded focus:ring-primary transition-all cursor-pointer\"\n                                type=\"checkbox\"\n                                name=\"addon-wheelchair\"\n                                checked={formData.addons.wheelchair}\n                                onChange={handleChange}\n                              />\n                              <span className=\"text-sm font-bold text-slate-700 group-hover:text-primary transition-colors\">\n                                Wheelchair\n                              </span>\n                            </label>\n                            <div className=\"relative w-32\">\n                              <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3\">\n                                <span className=\"text-slate-400 font-bold sm:text-xs\">\n                                  $\n                                </span>\n                              </div>\n                              <input\n                                className=\"block w-full h-10 rounded-lg border-slate-200 pl-7 text-right focus:border-primary focus:ring focus:ring-primary/10 sm:text-sm font-bold text-slate-700\"\n                                name=\"price-wheelchair\"\n                                value={formData.prices?.wheelchair || \"\"}\n                                onChange={handleChange}\n                                placeholder=\"0.00\"\n                                type=\"number\"\n                              />\n                            </div>\n                          </div>\n                          <div className=\"pt-6 mt-2 border-t border-slate-100 flex items-center justify-between\">\n                            <span className=\"text-sm font-bold text-slate-500 uppercase tracking-wider\">\n                              Add-ons Subtotal\n                            </span>\n                            <div className=\"text-xl font-black text-primary\">\n                              ${calculateAddonsTotal()}\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"space-y-8\">\n                          <div>\n                            <label\n                              className=\"block text-sm font-bold text-slate-700 mb-2 tracking-tight\"\n                              htmlFor=\"frequent-flyer\"\n                            >\n                              Frequent Flyer Number\n                            </label>\n                            <div className=\"relative rounded-lg shadow-sm\">\n                              <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4\">\n                                <span\n                                  className=\"material-symbols-outlined text-slate-400\"\n                                  style={{ fontSize: \"20px\" }}\n                                >\n                                  loyalty\n                                </span>\n                              </div>\n                              <input\n                                className=\"block w-full h-12 rounded-lg border-slate-200 pl-11 focus:border-primary focus:ring focus:ring-primary/10 transition-all sm:text-sm font-medium\"\n                                id=\"frequent-flyer\"\n                                name=\"frequentFlyer\"\n                                placeholder=\"e.g. AA-12345678\"\n                                type=\"text\"\n                                value={formData.frequentFlyer}\n                                onChange={handleChange}\n                                disabled={isReadOnly}\n                              />\n                            </div>\n                          </div>\n                          <div>\n                            <label className=\"block text-sm font-bold text-slate-700 mb-3 tracking-tight\">\n                              Seat Selection\n                            </label>\n                            <div className=\"border-2 border-dashed border-slate-200 rounded-xl p-6 bg-slate-50/50 flex flex-col items-center justify-center text-center hover:bg-slate-100 hover:border-primary/30 transition-all cursor-pointer group h-28\">\n                              <span\n                                className=\"material-symbols-outlined text-slate-400 group-hover:text-primary mb-2 transition-colors\"\n                                style={{ fontSize: \"28px\" }}\n                              >\n                                event_seat\n                              </span>\n                              <span className=\"text-sm font-bold text-slate-600 group-hover:text-primary transition-colors tracking-tight\">\n                                Select Premium Seat\n                              </span>\n                              <span className=\"text-xs text-primary mt-1 font-black bg-blue-50 px-2 py-0.5 rounded\">\n                                FROM $25.00\n                              </span>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Right Column (Sidebar) */}\n                <div className=\"space-y-6\">\n                  {/* Booking Details */}\n                  <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden transition-all hover:shadow-md\">\n                    <div className=\"px-6 py-4 border-b border-slate-100 bg-slate-50/50\">\n                      <h3 className=\"text-base font-bold text-slate-900 tracking-tight\">\n                        Booking Details\n                      </h3>\n                    </div>\n                    <div className=\"p-6 space-y-5\">\n                      <div>\n                        <label className=\"block text-xs font-bold text-slate-400 uppercase tracking-widest mb-2\">\n                          ID Ref (Read Only)\n                        </label>\n                        <input\n                          className=\"block w-full h-11 rounded-lg border-slate-100 bg-slate-50 text-slate-400 shadow-none cursor-not-allowed sm:text-sm font-mono\"\n                          readOnly\n                          type=\"text\"\n                          value={booking?.id ? `#${booking.id}` : \"NEW\"}\n                        />\n                      </div>\n                      <div>\n                        <label\n                          className=\"block text-xs font-bold text-slate-700 uppercase tracking-widest mb-2\"\n                          htmlFor=\"pnr\"\n                        >\n                          PNR Reference\n                        </label>\n                        <input\n                          className=\"block w-full h-11 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 font-mono uppercase sm:text-sm font-bold text-slate-700 pl-4\"\n                          name=\"pnr\"\n                          type=\"text\"\n                          value={formData.pnr}\n                          onChange={handleChange}\n                          disabled={isReadOnly}\n                        />\n                      </div>\n                      <div>\n                        <label\n                          className=\"block text-xs font-bold text-slate-700 uppercase tracking-widest mb-2\"\n                          htmlFor=\"agency\"\n                        >\n                          Issued through\n                        </label>\n                        <select\n                          className=\"block w-full h-10 rounded-lg border-slate-200 px-3 focus:border-primary focus:ring focus:ring-primary/10 sm:text-sm font-medium\"\n                          name=\"agency\"\n                          value={formData.agency}\n                          onChange={handleChange}\n                          disabled={isReadOnly}\n                        >\n                          <option value=\"\">\n                            {agenciesLoading\n                              ? \"Loading agencies...\"\n                              : \"Select issuing agency\"}\n                          </option>\n                          {agencies.map((agency) => (\n                            <option key={agency.uid} value={agency.agency_name}>\n                              {agency.agency_name}\n                            </option>\n                          ))}\n                        </select>\n                      </div>\n                      <div>\n                        <label\n                          className=\"block text-xs font-bold text-slate-700 uppercase tracking-widest mb-2\"\n                          htmlFor=\"handledBy\"\n                        >\n                          Issued By\n                        </label>\n                        <select\n                          className=\"block w-full h-10 rounded-lg border-slate-200 px-3 focus:border-primary focus:ring focus:ring-primary/10 sm:text-sm font-medium\"\n                          name=\"handledBy\"\n                          value={formData.handledBy}\n                          onChange={handleChange}\n                          disabled={isReadOnly}\n                        >\n                          <option value=\"\">\n                            {usersLoading ? \"Loading users...\" : \"Select user\"}\n                          </option>\n                          {users.map((user) => (\n                            <option\n                              key={user.id}\n                              value={\n                                user.first_name && user.last_name\n                                  ? `${user.first_name} ${user.last_name}`\n                                  : user.username || user.email\n                              }\n                            >\n                              {user.first_name && user.last_name\n                                ? `${user.first_name} ${user.last_name}`\n                                : user.username || user.email}\n                            </option>\n                          ))}\n                        </select>\n                      </div>\n                      <div>\n                        <label\n                          className=\"block text-xs font-bold text-slate-700 uppercase tracking-widest mb-2\"\n                          htmlFor=\"status\"\n                        >\n                          Booking Status\n                        </label>\n                        <select\n                          className=\"block w-full h-11 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 sm:text-sm font-bold text-slate-700 px-4\"\n                          name=\"status\"\n                          value={formData.status}\n                          onChange={handleChange}\n                          disabled={isReadOnly}\n                        >\n                          <option>Confirmed</option>\n                          <option>Pending</option>\n                          <option>Cancelled</option>\n                        </select>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Financials */}\n                  <div className=\"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden transition-all hover:shadow-md\">\n                    <div className=\"px-6 py-4 border-b border-slate-100 bg-slate-50/50\">\n                      <h3 className=\"text-base font-bold text-slate-900 tracking-tight\">\n                        Financials Summary\n                      </h3>\n                    </div>\n                    <div className=\"p-6 space-y-5\">\n                      <div>\n                        <label\n                          className=\"block text-xs font-bold text-slate-700 uppercase tracking-widest mb-2\"\n                          htmlFor=\"payment-status\"\n                        >\n                          Payment Status\n                        </label>\n                        <select\n                          className=\"block w-full h-11 rounded-lg border-slate-200 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 sm:text-sm font-bold text-slate-700 px-4\"\n                          name=\"paymentStatus\"\n                          value={formData.paymentStatus}\n                          onChange={handleChange}\n                          disabled={isReadOnly}\n                        >\n                          <option>Paid</option>\n                          <option>Pending</option>\n                          <option>Refunded</option>\n                        </select>\n                      </div>\n                      <div>\n                        <label\n                          className=\"block text-xs font-bold text-slate-700 uppercase tracking-widest mb-2\"\n                          htmlFor=\"cost-price\"\n                        >\n                          Cost Price ($)\n                        </label>\n                        <div className=\"relative rounded-lg shadow-sm\">\n                          <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4\">\n                            <span className=\"text-slate-400 font-bold\">$</span>\n                          </div>\n                          <input\n                            className=\"block w-full h-11 rounded-lg border-slate-200 pl-8 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 sm:text-sm font-bold text-slate-700\"\n                            name=\"costPrice\"\n                            type=\"number\"\n                            step=\"0.01\"\n                            value={formData.costPrice}\n                            onChange={handleChange}\n                            disabled={isReadOnly}\n                          />\n                        </div>\n                      </div>\n                      <div>\n                        <label\n                          className=\"block text-xs font-bold text-slate-700 uppercase tracking-widest mb-2\"\n                          htmlFor=\"selling-price\"\n                        >\n                          Selling Price ($)\n                        </label>\n                        <div className=\"relative rounded-lg shadow-sm\">\n                          <div className=\"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4\">\n                            <span className=\"text-slate-400 font-bold\">$</span>\n                          </div>\n                          <input\n                            className=\"block w-full h-11 rounded-lg border-slate-200 pl-8 shadow-sm focus:border-primary focus:ring focus:ring-primary/10 sm:text-sm font-black text-primary\"\n                            name=\"sellingPrice\"\n                            type=\"number\"\n                            step=\"0.01\"\n                            value={formData.sellingPrice}\n                            onChange={handleChange}\n                            disabled={isReadOnly}\n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"bg-slate-50 rounded-xl p-5 mt-4 border border-slate-100\">\n                        <div className=\"flex justify-between items-center mb-3\">\n                          <span className=\"text-sm font-bold text-slate-500\">\n                            Net Cost\n                          </span>\n                          <span className=\"text-sm font-black text-slate-900\">\n                            ${formData.costPrice}\n                          </span>\n                        </div>\n                        <div className=\"flex justify-between items-center pt-4 border-t border-slate-200\">\n                          <span className=\"text-base font-black text-slate-900\">\n                            Grand Total\n                          </span>\n                          <span className=\"text-xl font-black text-primary tracking-tight\">\n                            ${calculateGrandTotal()}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Actions */}\n                  <div className=\"pt-4 flex flex-col gap-3 sticky bottom-0 bg-gray-50 p-2 -mx-2\">\n                    <button\n                      className=\"w-full flex justify-center items-center h-14 border border-transparent shadow-lg text-base font-black rounded-xl text-white bg-primary hover:bg-blue-600 transition-all transform hover:-translate-y-0.5 active:translate-y-0 shadow-blue-500/20 disabled:opacity-50\"\n                      type=\"submit\"\n                      disabled={isLoading}\n                    >\n                      <span className=\"material-symbols-outlined text-2xl mr-3\">\n                        save\n                      </span>\n                      {isLoading ? \"SAVING...\" : \"SAVE CHANGES\"}\n                    </button>\n                    <button\n                      className=\"w-full flex justify-center items-center h-14 border-2 border-slate-100 shadow-sm text-base font-bold rounded-xl text-slate-600 bg-white hover:bg-slate-50 hover:border-slate-200 transition-all\"\n                      type=\"button\"\n                      onClick={onClose}\n                    >\n                      CANCEL\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </form>\n          </main>\n        </div>\n      </div>\n\n      {/* Meal Modal */}\n      {isMealModalOpen && (\n        <div className=\"fixed inset-0 z-[60] flex justify-center items-center overflow-hidden\">\n          <div\n            className=\"absolute inset-0 bg-gray-900/50 backdrop-blur-sm\"\n            onClick={() => setIsMealModalOpen(false)}\n          ></div>\n          <div className=\"relative bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden ring-1 ring-slate-200 flex flex-col max-h-[90vh] transition-all transform scale-100\">\n            <div className=\"px-8 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50\">\n              <div>\n                <h3 className=\"text-xl font-black text-slate-900 tracking-tight\">\n                  Select Meal Options\n                </h3>\n                <p className=\"text-xs text-slate-500 font-medium mt-1 uppercase tracking-widest\">\n                  Premium Flight Services\n                </p>\n              </div>\n              <button\n                onClick={() => setIsMealModalOpen(false)}\n                className=\"text-slate-400 hover:text-slate-600 transition-all cursor-pointer p-2 rounded-xl hover:bg-slate-100\"\n              >\n                <span className=\"material-symbols-outlined font-bold\">\n                  close\n                </span>\n              </button>\n            </div>\n            <div className=\"p-8 space-y-6 overflow-y-auto\">\n              {[\n                {\n                  id: \"vml\",\n                  name: \"Vegetarian Hindu Meal\",\n                  desc: \"No beef, no pork, prepared with dairy.\",\n                },\n                {\n                  id: \"moors\",\n                  name: \"Muslim Meal\",\n                  desc: \"No pork, no alcohol, Halal certified.\",\n                },\n                {\n                  id: \"ksml\",\n                  name: \"Kosher Meal\",\n                  desc: \"Prepared under rabbinic supervision.\",\n                },\n                {\n                  id: \"vgml\",\n                  name: \"Vegan Meal\",\n                  desc: \"No animal products, no honey or eggs.\",\n                },\n                {\n                  id: \"gfml\",\n                  name: \"Gluten Free Meal\",\n                  desc: \"Prepared without wheat, barley or rye.\",\n                },\n              ].map((meal) => (\n                <label\n                  key={meal.id}\n                  className=\"flex items-start gap-4 p-4 rounded-xl border border-slate-100 hover:border-primary/30 hover:bg-blue-50/30 cursor-pointer transition-all group\"\n                >\n                  <div className=\"flex items-center h-6 mt-1\">\n                    <input\n                      name=\"meal-selection\"\n                      type=\"radio\"\n                      className=\"w-5 h-5 text-primary border-slate-300 focus:ring-primary cursor-pointer\"\n                    />\n                  </div>\n                  <div>\n                    <p className=\"text-sm font-black text-slate-900 group-hover:text-primary transition-colors\">\n                      {meal.name}\n                    </p>\n                    <p className=\"text-xs text-slate-500 font-medium mt-1 leading-relaxed\">\n                      {meal.desc}\n                    </p>\n                  </div>\n                </label>\n              ))}\n            </div>\n            <div className=\"px-8 py-5 border-t border-slate-100 flex justify-end gap-4 bg-slate-50/50\">\n              <button\n                onClick={() => setIsMealModalOpen(false)}\n                className=\"px-6 py-2.5 text-sm font-bold text-slate-600 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition-all\"\n              >\n                CLOSE\n              </button>\n              <button\n                onClick={() => setIsMealModalOpen(false)}\n                className=\"px-8 py-2.5 text-sm font-black text-white bg-primary rounded-xl hover:bg-blue-600 shadow-lg shadow-blue-500/20 transition-all\"\n              >\n                CONFIRM SELECTION\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Material Icons Link Removed */}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4689, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/buddh/skytrips-admin/src/components/RefundConfirmModal.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useRef } from \"react\";\r\n\r\nexport default function RefundConfirmModal({\r\n  isOpen,\r\n  bookingId,\r\n  bookingDate,\r\n  amount,\r\n  onConfirm,\r\n  onCancel,\r\n  isProcessing = false,\r\n  isAuthenticated = true,\r\n  onRequireAuth,\r\n  hideWarning = false,\r\n}: {\r\n  isOpen: boolean;\r\n  bookingId: number;\r\n  bookingDate: string;\r\n  amount: number;\r\n  onConfirm: () => void;\r\n  onCancel: () => void;\r\n  isProcessing?: boolean;\r\n  isAuthenticated?: boolean;\r\n  onRequireAuth?: () => void;\r\n  hideWarning?: boolean;\r\n}) {\r\n  const dialogRef = useRef<HTMLDivElement | null>(null);\r\n  const firstBtnRef = useRef<HTMLButtonElement | null>(null);\r\n  const lastBtnRef = useRef<HTMLButtonElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    const onKey = (e: KeyboardEvent) => {\r\n      if (e.key === \"Escape\") {\r\n        onCancel();\r\n      }\r\n      if (e.key === \"Tab\") {\r\n        if (!dialogRef.current) return;\r\n        const focusable = dialogRef.current.querySelectorAll<HTMLElement>(\r\n          \"button, [href], input, select, textarea, [tabindex]:not([tabindex='-1'])\"\r\n        );\r\n        if (focusable.length === 0) return;\r\n        const first = focusable[0];\r\n        const last = focusable[focusable.length - 1];\r\n        if (e.shiftKey && document.activeElement === first) {\r\n          e.preventDefault();\r\n          last.focus();\r\n        } else if (!e.shiftKey && document.activeElement === last) {\r\n          e.preventDefault();\r\n          first.focus();\r\n        }\r\n      }\r\n    };\r\n    document.addEventListener(\"keydown\", onKey);\r\n    return () => document.removeEventListener(\"keydown\", onKey);\r\n  }, [isOpen, onCancel]);\r\n\r\n  useEffect(() => {\r\n    if (isOpen && firstBtnRef.current) {\r\n      firstBtnRef.current.focus();\r\n    }\r\n  }, [isOpen]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      aria-labelledby=\"refund-title\"\r\n      className=\"fixed inset-0 z-50 flex items-center justify-center\"\r\n      onClick={(e) => {\r\n        if (e.target === e.currentTarget) onCancel();\r\n      }}\r\n    >\r\n      <div className=\"absolute inset-0 bg-black/40 animate-in fade-in duration-200\"></div>\r\n      <div\r\n        ref={dialogRef}\r\n        className=\"relative bg-white rounded-xl shadow-2xl border border-slate-200 w-full max-w-md mx-4 animate-in fade-in zoom-in duration-200\"\r\n      >\r\n        <div className=\"px-6 py-4 border-b border-slate-100\">\r\n          <h2 id=\"refund-title\" className=\"text-lg font-bold text-slate-900\">\r\n            Confirm Refund Request\r\n          </h2>\r\n        </div>\r\n        <div className=\"px-6 py-4 space-y-3\">\r\n          <div className=\"text-sm text-slate-700\">\r\n            Booking ID: <span className=\"font-mono font-bold text-primary\">#{bookingId}</span>\r\n          </div>\r\n          <div className=\"text-sm text-slate-700\">Date: <span className=\"font-medium\">{bookingDate || \"-\"}</span></div>\r\n          <div className=\"text-sm text-slate-700\">Amount: <span className=\"font-medium\">${Number(amount).toFixed(2)}</span></div>\r\n          {!hideWarning && (\r\n            <p className=\"text-xs text-red-600 mt-2\">\r\n              This action cannot be undone. The booking will be marked for refund processing.\r\n            </p>\r\n          )}\r\n        </div>\r\n        <div className=\"px-6 py-4 flex items-center justify-end gap-3 border-t border-slate-100\">\r\n          <div className=\"relative group\">\r\n            <button\r\n            ref={firstBtnRef}\r\n            onClick={onCancel}\r\n            className=\"px-4 py-2 rounded-lg bg_white border border-slate-200 text-slate-700 text-sm font-bold hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-primary/30\"\r\n            aria-label=\"Cancel refund\"\r\n            disabled={isProcessing}\r\n            >\r\n              Cancel\r\n            </button>\r\n          </div>\r\n          <button\r\n            ref={lastBtnRef}\r\n            onClick={() => {\r\n              if (!isAuthenticated) {\r\n                if (onRequireAuth) onRequireAuth();\r\n                return;\r\n              }\r\n              onConfirm();\r\n            }}\r\n            className=\"px-4 py-2 rounded-lg bg-primary text-white text-sm font-bold hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary/30 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n            aria-label=\"Confirm refund\"\r\n            disabled={isProcessing || !isAuthenticated}\r\n            >\r\n            {isProcessing ? (\r\n              <span className=\"size-4 border-2 border-white/30 border-t-white rounded-full animate-spin\"></span>\r\n            ) : null}\r\n            <span>Confirm Refund</span>\r\n          </button>\r\n          {!isAuthenticated && (\r\n            <div role=\"tooltip\" className=\"ml-2 text-xs text-slate-600\">\r\n              Sign in required\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4954, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/buddh/skytrips-admin/src/components/SignInPromptModal.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useRef } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nexport default function SignInPromptModal({\r\n  isOpen,\r\n  onClose,\r\n}: {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}) {\r\n  const dialogRef = useRef<HTMLDivElement | null>(null);\r\n  const firstBtnRef = useRef<HTMLButtonElement | null>(null);\r\n  const lastBtnRef = useRef<HTMLButtonElement | null>(null);\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    if (!isOpen) return;\r\n    const onKey = (e: KeyboardEvent) => {\r\n      if (e.key === \"Escape\") onClose();\r\n      if (e.key === \"Tab\") {\r\n        if (!dialogRef.current) return;\r\n        const focusable = dialogRef.current.querySelectorAll<HTMLElement>(\r\n          \"button, [href], input, select, textarea, [tabindex]:not([tabindex='-1'])\"\r\n        );\r\n        if (focusable.length === 0) return;\r\n        const first = focusable[0];\r\n        const last = focusable[focusable.length - 1];\r\n        if (e.shiftKey && document.activeElement === first) {\r\n          e.preventDefault();\r\n          last.focus();\r\n        } else if (!e.shiftKey && document.activeElement === last) {\r\n          e.preventDefault();\r\n          first.focus();\r\n        }\r\n      }\r\n    };\r\n    document.addEventListener(\"keydown\", onKey);\r\n    return () => document.removeEventListener(\"keydown\", onKey);\r\n  }, [isOpen, onClose]);\r\n\r\n  useEffect(() => {\r\n    if (isOpen && firstBtnRef.current) firstBtnRef.current.focus();\r\n  }, [isOpen]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      aria-labelledby=\"signin-title\"\r\n      className=\"fixed inset-0 z-50 flex items-center justify-center\"\r\n      onClick={(e) => {\r\n        if (e.target === e.currentTarget) onClose();\r\n      }}\r\n    >\r\n      <div className=\"absolute inset-0 bg-black/40 animate-in fade-in duration-200\"></div>\r\n      <div\r\n        ref={dialogRef}\r\n        className=\"relative bg-white rounded-xl shadow-2xl border border-slate-200 w-full max-w-md mx-4 animate-in fade-in zoom-in duration-200\"\r\n      >\r\n        <div className=\"px-6 py-4 border-b border-slate-100\">\r\n          <h2 id=\"signin-title\" className=\"text-lg font-bold text-slate-900\">\r\n            Sign In Required\r\n          </h2>\r\n        </div>\r\n        <div className=\"px-6 py-4 space-y-3\">\r\n          <p className=\"text-sm text-slate-700\">\r\n            You need to be authenticated to confirm refunds. Please sign in to continue.\r\n          </p>\r\n        </div>\r\n        <div className=\"px-6 py-4 flex items-center justify-end gap-3 border-t border-slate-100\">\r\n          <button\r\n            ref={firstBtnRef}\r\n            onClick={onClose}\r\n            className=\"px-4 py-2 rounded-lg bg-white border border-slate-200 text-slate-700 text-sm font-bold hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-primary/30\"\r\n            aria-label=\"Cancel\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            ref={lastBtnRef}\r\n            onClick={() => {\r\n              router.push(\"/login\");\r\n            }}\r\n            className=\"px-4 py-2 rounded-lg bg-primary text-white text-sm font-bold hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary/30\"\r\n            aria-label=\"Go to sign in\"\r\n          >\r\n            Sign In\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;AAFA;;;AAIe,SAAS,kBAAkB,EACxC,MAAM,EACN,OAAO,EAIR;;IACC,MAAM,YAAY,IAAA,4LAAM,EAAwB;IAChD,MAAM,cAAc,IAAA,4LAAM,EAA2B;IACrD,MAAM,aAAa,IAAA,4LAAM,EAA2B;IACpD,MAAM,SAAS,IAAA,uKAAS;IAExB,IAAA,+LAAS;uCAAC;YACR,IAAI,CAAC,QAAQ;YACb,MAAM;qDAAQ,CAAC;oBACb,IAAI,EAAE,GAAG,KAAK,UAAU;oBACxB,IAAI,EAAE,GAAG,KAAK,OAAO;wBACnB,IAAI,CAAC,UAAU,OAAO,EAAE;wBACxB,MAAM,YAAY,UAAU,OAAO,CAAC,gBAAgB,CAClD;wBAEF,IAAI,UAAU,MAAM,KAAK,GAAG;wBAC5B,MAAM,QAAQ,SAAS,CAAC,EAAE;wBAC1B,MAAM,OAAO,SAAS,CAAC,UAAU,MAAM,GAAG,EAAE;wBAC5C,IAAI,EAAE,QAAQ,IAAI,SAAS,aAAa,KAAK,OAAO;4BAClD,EAAE,cAAc;4BAChB,KAAK,KAAK;wBACZ,OAAO,IAAI,CAAC,EAAE,QAAQ,IAAI,SAAS,aAAa,KAAK,MAAM;4BACzD,EAAE,cAAc;4BAChB,MAAM,KAAK;wBACb;oBACF;gBACF;;YACA,SAAS,gBAAgB,CAAC,WAAW;YACrC;+CAAO,IAAM,SAAS,mBAAmB,CAAC,WAAW;;QACvD;sCAAG;QAAC;QAAQ;KAAQ;IAEpB,IAAA,+LAAS;uCAAC;YACR,IAAI,UAAU,YAAY,OAAO,EAAE,YAAY,OAAO,CAAC,KAAK;QAC9D;sCAAG;QAAC;KAAO;IAEX,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,kNAAC;QACC,MAAK;QACL,cAAW;QACX,mBAAgB;QAChB,WAAU;QACV,SAAS,CAAC;YACR,IAAI,EAAE,MAAM,KAAK,EAAE,aAAa,EAAE;QACpC;;0BAEA,kNAAC;gBAAI,WAAU;;;;;;0BACf,kNAAC;gBACC,KAAK;gBACL,WAAU;;kCAEV,kNAAC;wBAAI,WAAU;kCACb,cAAA,kNAAC;4BAAG,IAAG;4BAAe,WAAU;sCAAmC;;;;;;;;;;;kCAIrE,kNAAC;wBAAI,WAAU;kCACb,cAAA,kNAAC;4BAAE,WAAU;sCAAyB;;;;;;;;;;;kCAIxC,kNAAC;wBAAI,WAAU;;0CACb,kNAAC;gCACC,KAAK;gCACL,SAAS;gCACT,WAAU;gCACV,cAAW;0CACZ;;;;;;0CAGD,kNAAC;gCACC,KAAK;gCACL,SAAS;oCACP,OAAO,IAAI,CAAC;gCACd;gCACA,WAAU;gCACV,cAAW;0CACZ;;;;;;;;;;;;;;;;;;;;;;;;AAOX;GA3FwB;;QAUP,uKAAS;;;KAVF"}},
    {"offset": {"line": 5123, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/buddh/skytrips-admin/src/components/BookingRowMenu.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport RefundConfirmModal from \"@/components/RefundConfirmModal\";\r\nimport SignInPromptModal from \"@/components/SignInPromptModal\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { ManageBooking } from \"@/types\";\r\nimport { Booking } from \"@/types\";\r\n\r\nexport default function BookingRowMenu({\r\n  booking,\r\n  onRefund,\r\n  onReissue,\r\n}: {\r\n  booking: Booking;\r\n  onRefund: () => void;\r\n  onReissue: () => void;\r\n}) {\r\n  const [open, setOpen] = useState(false);\r\n  const [activeIndex, setActiveIndex] = useState<number>(-1);\r\n  const wrapperRef = useRef<HTMLDivElement | null>(null);\r\n  const [isRefundOpen, setIsRefundOpen] = useState(false);\r\n  const [pendingUid, setPendingUid] = useState<string | null>(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [isSignInPromptOpen, setIsSignInPromptOpen] = useState(false);\r\n  const [isAuthorizedUser, setIsAuthorizedUser] = useState(false);\r\n  const [localUser, setLocalUser] = useState<{\r\n    id: string;\r\n    email: string;\r\n  } | null>(null);\r\n\r\n  useEffect(() => {\r\n    const checkUserAuthorization = async () => {\r\n      let emailToCheck = \"\";\r\n      let userId = \"\";\r\n\r\n      // 1. Try localStorage \"sky_admin_user\"\r\n      if (typeof window !== \"undefined\") {\r\n        const storedStr = localStorage.getItem(\"sky_admin_user\");\r\n        if (storedStr) {\r\n          try {\r\n            const parsed = JSON.parse(storedStr);\r\n            if (parsed.email) {\r\n              emailToCheck = parsed.email;\r\n              userId = parsed.id;\r\n            }\r\n          } catch (e) {\r\n            console.error(\"Error parsing sky_admin_user\", e);\r\n          }\r\n        }\r\n      }\r\n\r\n      // 2. Fallback to Supabase auth if not found in localStorage\r\n      if (!emailToCheck) {\r\n        const {\r\n          data: { user },\r\n        } = await supabase.auth.getUser();\r\n        if (user && user.email) {\r\n          emailToCheck = user.email;\r\n          userId = user.id;\r\n        }\r\n      }\r\n\r\n      if (emailToCheck) {\r\n        // Check if user exists in the 'users' list\r\n        const { data } = await supabase\r\n          .from(\"users\")\r\n          .select(\"email\")\r\n          .eq(\"email\", emailToCheck)\r\n          .maybeSingle();\r\n\r\n        if (data) {\r\n          setIsAuthorizedUser(true);\r\n          setLocalUser({ id: userId, email: emailToCheck });\r\n        }\r\n      }\r\n    };\r\n    checkUserAuthorization();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (\r\n        wrapperRef.current &&\r\n        !wrapperRef.current.contains(event.target as Node)\r\n      ) {\r\n        setOpen(false);\r\n        setActiveIndex(-1);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    supabase.auth.getSession().then(({ data }) => {\r\n      setIsAuthenticated(!!data.session);\r\n    });\r\n    const { data: authSub } = supabase.auth.onAuthStateChange(\r\n      (_event, session) => {\r\n        setIsAuthenticated(!!session);\r\n      },\r\n    );\r\n    return () => {\r\n      authSub.subscription.unsubscribe();\r\n    };\r\n  }, []);\r\n\r\n  const options = [\r\n    {\r\n      label: \"Refund\",\r\n      icon: \"currency_exchange\",\r\n      action: async () => {\r\n        const { data, error: preError } = await supabase\r\n          .from(\"manage_booking\")\r\n          .select(\"uid\")\r\n          .eq(\"booking_id\", String(booking.id))\r\n          .limit(1)\r\n          .maybeSingle();\r\n        if (!preError && data && (data as ManageBooking).uid) {\r\n          setPendingUid((data as ManageBooking).uid);\r\n        } else {\r\n          setPendingUid(crypto.randomUUID());\r\n        }\r\n        setIsRefundOpen(true);\r\n      },\r\n    },\r\n    { label: \"Re-issue\", icon: \"sync\", action: onReissue },\r\n  ];\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLButtonElement>) => {\r\n    if (\r\n      !open &&\r\n      (e.key === \"ArrowDown\" || e.key === \"Enter\" || e.key === \" \")\r\n    ) {\r\n      e.preventDefault();\r\n      setOpen(true);\r\n      setActiveIndex(0);\r\n      return;\r\n    }\r\n    if (open) {\r\n      if (e.key === \"ArrowDown\") {\r\n        e.preventDefault();\r\n        setActiveIndex((prev) => (prev + 1) % options.length);\r\n      } else if (e.key === \"ArrowUp\") {\r\n        e.preventDefault();\r\n        setActiveIndex((prev) => (prev <= 0 ? options.length - 1 : prev - 1));\r\n      } else if (e.key === \"Enter\") {\r\n        e.preventDefault();\r\n        if (activeIndex >= 0) {\r\n          options[activeIndex].action();\r\n          setOpen(false);\r\n          setActiveIndex(-1);\r\n        }\r\n      } else if (e.key === \"Escape\") {\r\n        setOpen(false);\r\n        setActiveIndex(-1);\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div ref={wrapperRef} className=\"relative flex flex-col items-center\">\r\n      <button\r\n        type=\"button\"\r\n        aria-label=\"Open actions menu\"\r\n        aria-haspopup=\"true\"\r\n        aria-expanded={open}\r\n        onClick={() => setOpen((o) => !o)}\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n        className=\"size-10 min-w-10 min-h-10 flex items-center justify-center rounded-full text-slate-600 hover:bg-slate-100 hover:text-primary transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary/30 mt-2\"\r\n      >\r\n        <span className=\"material-symbols-outlined text-[18px]\">more_vert</span>\r\n      </button>\r\n      {open && (\r\n        <div\r\n          role=\"menu\"\r\n          aria-label={`Actions for booking ${booking.id}`}\r\n          className=\"absolute z-30 mt-2 w-40 bg-white border border-slate-200 rounded-lg shadow-xl animate-in fade-in duration-300\"\r\n        >\r\n          <ul className=\"py-2\">\r\n            {options.map((opt, idx) => (\r\n              <li key={opt.label}>\r\n                <button\r\n                  role=\"menuitem\"\r\n                  tabIndex={0}\r\n                  aria-label={opt.label}\r\n                  onClick={() => {\r\n                    opt.action();\r\n                    setOpen(false);\r\n                    setActiveIndex(-1);\r\n                  }}\r\n                  className={`w-full flex items-center gap-2 px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 transition-all duration-200 ${activeIndex === idx ? \"bg-slate-50\" : \"\"}`}\r\n                  onMouseEnter={() => setActiveIndex(idx)}\r\n                >\r\n                  <span className=\"material-symbols-outlined text-[18px] transition-transform duration-200 group-hover:scale-105\">\r\n                    {opt.icon}\r\n                  </span>\r\n                  <span>{opt.label}</span>\r\n                </button>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      )}\r\n      {isRefundOpen && (\r\n        <RefundConfirmModal\r\n          isOpen={isRefundOpen}\r\n          bookingId={booking.id}\r\n          bookingDate={\r\n            booking.travelDate ||\r\n            `${booking.IssueDay || \"\"} ${booking.issueMonth || \"\"} ${booking.issueYear || \"\"}`\r\n          }\r\n          amount={Number(booking.sellingPrice || booking.buyingPrice || 0)}\r\n          isAuthenticated={isAuthenticated || !!localUser}\r\n          onRequireAuth={() => setIsSignInPromptOpen(true)}\r\n          hideWarning={isAuthorizedUser}\r\n          onConfirm={async () => {\r\n            console.log(\"analytics:event\", {\r\n              type: \"refund_confirmed\",\r\n              bookingId: booking.id,\r\n              amount: booking.sellingPrice || booking.buyingPrice || 0,\r\n            });\r\n            setIsSubmitting(true);\r\n\r\n            let finalUserId = \"\";\r\n            const {\r\n              data: { session },\r\n              error: sessError,\r\n            } = await supabase.auth.getSession();\r\n\r\n            if (session) {\r\n              finalUserId = session.user.id;\r\n            } else if (localUser && localUser.id) {\r\n              finalUserId = localUser.id;\r\n            }\r\n\r\n            if (sessError && !finalUserId) {\r\n              alert(\"Authentication check failed\");\r\n              setIsSubmitting(false);\r\n              return;\r\n            }\r\n            if (!finalUserId) {\r\n              alert(\"Sign in required\");\r\n              setIsSubmitting(false);\r\n              return;\r\n            }\r\n            if (!booking.id) {\r\n              alert(\"Invalid booking ID\");\r\n              setIsSubmitting(false);\r\n              return;\r\n            }\r\n            if (!pendingUid) {\r\n              alert(\"Unable to generate UID\");\r\n              setIsSubmitting(false);\r\n              return;\r\n            }\r\n            try {\r\n              // Use API to create manage booking record with type and details\r\n              const res = await fetch(\"/api/manage-booking\", {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({\r\n                  uid: pendingUid,\r\n                  booking: booking,\r\n                  user_id: finalUserId,\r\n                  type: \"Refund\",\r\n                }),\r\n              });\r\n\r\n              if (!res.ok) {\r\n                const j = await res.json();\r\n                throw new Error(\r\n                  j.error || \"Failed to create manage booking record\",\r\n                );\r\n              }\r\n            } catch (e) {\r\n              console.error(\r\n                \"Insert exception:\",\r\n                e instanceof Error ? e.message : e,\r\n              );\r\n              alert(\r\n                \"Network or server error while creating manage booking record\",\r\n              );\r\n              setIsSubmitting(false);\r\n              return;\r\n            }\r\n            setIsRefundOpen(false);\r\n            setIsSubmitting(false);\r\n            onRefund();\r\n          }}\r\n          onCancel={() => {\r\n            console.log(\"analytics:event\", {\r\n              type: \"refund_cancelled\",\r\n              bookingId: booking.id,\r\n            });\r\n            setIsRefundOpen(false);\r\n          }}\r\n          isProcessing={isSubmitting}\r\n        />\r\n      )}\r\n      {isSignInPromptOpen && (\r\n        <SignInPromptModal\r\n          isOpen={isSignInPromptOpen}\r\n          onClose={() => setIsSignInPromptOpen(false)}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5468, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/buddh/skytrips-admin/src/app/dashboard/booking/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { Booking } from \"@/types\";\r\nimport BookingModal from \"./BookingModal\";\r\nimport BookingRowMenu from \"@/components/BookingRowMenu\";\r\n\r\nexport default function BookingPage() {\r\n  const router = useRouter();\r\n  const [bookings, setBookings] = useState<Booking[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [editingBooking, setEditingBooking] = useState<Booking | null>(null);\r\n  const [actionLoading, setActionLoading] = useState<number | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [pageSize, setPageSize] = useState(10);\r\n  const [totalCount, setTotalCount] = useState(0);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const [debouncedSearch, setDebouncedSearch] = useState(\"\");\r\n  const [sortConfig, setSortConfig] = useState<{\r\n    key: string;\r\n    direction: \"asc\" | \"desc\";\r\n  }>({\r\n    key: \"id\",\r\n    direction: \"desc\",\r\n  });\r\n\r\n  const [isViewOnly, setIsViewOnly] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchBookings();\r\n  }, [currentPage, pageSize, debouncedSearch, sortConfig]);\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setDebouncedSearch(searchTerm);\r\n      setCurrentPage(1); // Reset to first page on search\r\n    }, 500);\r\n\r\n    return () => clearTimeout(timer);\r\n  }, [searchTerm]);\r\n\r\n  const fetchBookings = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const from = (currentPage - 1) * pageSize;\r\n      const to = from + pageSize - 1;\r\n\r\n      console.log(\"Fetching bookings with Supabase SDK\", {\r\n        from,\r\n        to,\r\n        search: debouncedSearch,\r\n      });\r\n      console.log(\"Supabase URL:\", process.env.NEXT_PUBLIC_SUPABASE_URL);\r\n      console.log(\"Has Anon Key:\", !!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);\r\n\r\n      let query = supabase.from(\"bookings\").select(\"*\", { count: \"exact\" });\r\n\r\n      // Handle Sorting\r\n      if (sortConfig.key === \"travelDate\") {\r\n        // travelDate doesn't exist in DB, it's computed from IssueDay, issueMonth, issueYear\r\n        // For now, let's sort by issueYear, then issueMonth (string sort), then IssueDay\r\n        // Note: issueMonth is string (e.g., 'Oct '), so this won't be perfectly chronological\r\n        // without complex logic or a real travelDate column.\r\n        // We'll sort by issueYear first.\r\n        query = query\r\n          .order(\"issueYear\", { ascending: sortConfig.direction === \"asc\" })\r\n          .order(\"issueMonth\", { ascending: sortConfig.direction === \"asc\" })\r\n          .order(\"IssueDay\", { ascending: sortConfig.direction === \"asc\" });\r\n      } else if (sortConfig.key === \"sellingPrice\") {\r\n        // Fallback to buyingPrice if sellingPrice is null\r\n        query = query.order(\"sellingPrice\", {\r\n          ascending: sortConfig.direction === \"asc\",\r\n          nullsFirst: false,\r\n        });\r\n      } else {\r\n        query = query.order(sortConfig.key, {\r\n          ascending: sortConfig.direction === \"asc\",\r\n        });\r\n      }\r\n\r\n      query = query.range(from, to);\r\n\r\n      if (debouncedSearch) {\r\n        const isNumeric = /^\\d+$/.test(debouncedSearch);\r\n        // Deprecated fields removed from search filter\r\n        let orFilter = `origin.eq.${debouncedSearch},destination.eq.${debouncedSearch},PNR.eq.${debouncedSearch}`;\r\n\r\n        if (isNumeric) {\r\n          orFilter += `,id.eq.${debouncedSearch}`;\r\n        }\r\n\r\n        query = query.or(orFilter);\r\n      }\r\n\r\n      const { data, count, error: fetchError } = await query;\r\n\r\n      console.log(\"Query result:\", { data, count, error: fetchError });\r\n\r\n      if (fetchError) {\r\n        console.error(\"Supabase error details:\", {\r\n          message: fetchError.message,\r\n          details: fetchError.details,\r\n          hint: fetchError.hint,\r\n          code: fetchError.code,\r\n        });\r\n        throw fetchError;\r\n      }\r\n\r\n      setBookings(data || []);\r\n      setTotalCount(count || 0);\r\n      console.log(\"Successfully loaded bookings:\", data?.length || 0);\r\n    } catch (err: any) {\r\n      console.error(\"Fetch error:\", err);\r\n      const errorMessage = err.message || \"Failed to fetch bookings\";\r\n      const errorDetails = err.details ? ` - ${err.details}` : \"\";\r\n      const errorHint = err.hint ? ` (Hint: ${err.hint})` : \"\";\r\n      setError(errorMessage + errorDetails + errorHint);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const totalPages = Math.ceil(totalCount / pageSize);\r\n\r\n  const handlePrevPage = () => {\r\n    if (currentPage > 1) setCurrentPage(currentPage - 1);\r\n  };\r\n\r\n  const handleNextPage = () => {\r\n    if (currentPage < totalPages) setCurrentPage(currentPage + 1);\r\n  };\r\n\r\n  const handleSort = (key: string) => {\r\n    setSortConfig((current) => ({\r\n      key,\r\n      direction:\r\n        current.key === key && current.direction === \"asc\" ? \"desc\" : \"asc\",\r\n    }));\r\n  };\r\n\r\n  const renderSortIcon = (key: string) => {\r\n    if (sortConfig.key !== key) {\r\n      return (\r\n        <span className=\"material-symbols-outlined text-[16px] text-slate-300 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n          unfold_more\r\n        </span>\r\n      );\r\n    }\r\n    return (\r\n      <span className=\"material-symbols-outlined text-[16px] text-primary font-bold\">\r\n        {sortConfig.direction === \"asc\" ? \"arrow_upward\" : \"arrow_downward\"}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  const handleCreate = () => {\r\n    setEditingBooking(null);\r\n    setIsViewOnly(false);\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const handleView = (booking: Booking) => {\r\n    // Navigate to booking details page\r\n    router.push(`/dashboard/booking/${booking.id}`);\r\n  };\r\n\r\n  const handleEdit = (booking: Booking) => {\r\n    setEditingBooking(booking);\r\n    setIsViewOnly(false);\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const handleDelete = async (id: number) => {\r\n    if (!confirm(\"Are you sure you want to delete this booking?\")) {\r\n      return;\r\n    }\r\n\r\n    setActionLoading(id);\r\n    try {\r\n      const { error: deleteError } = await supabase\r\n        .from(\"bookings\")\r\n        .delete()\r\n        .eq(\"id\", id);\r\n\r\n      if (deleteError) throw deleteError;\r\n      await fetchBookings();\r\n    } catch (err: any) {\r\n      alert(err.message || \"Failed to delete booking\");\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  const handleSave = async (booking: Booking) => {\r\n    setActionLoading(-1);\r\n\r\n    try {\r\n      let bookingToSave = { ...booking };\r\n\r\n      // Handle New Customer Creation logic\r\n      if (booking.contactType === \"new\" && booking.email) {\r\n        console.log(\"Processing new customer creation for:\", booking.email);\r\n\r\n        // 1. Check if customer already exists\r\n        const { data: existingCustomer, error: searchError } = await supabase\r\n          .from(\"customers\")\r\n          .select(\"id\")\r\n          .eq(\"email\", booking.email)\r\n          .single();\r\n\r\n        if (searchError && searchError.code !== \"PGRST116\") {\r\n          // PGRST116 is \"Row not found\" - ignore that, but log others\r\n          console.error(\"Error searching for existing customer:\", searchError);\r\n        }\r\n\r\n        let customerIdToUse = existingCustomer?.id;\r\n\r\n        if (!customerIdToUse) {\r\n          // 2. Create new customer\r\n          const firstName = booking.travellers?.[0]?.firstName || \"Unknown\";\r\n          const lastName = booking.travellers?.[0]?.lastName || \"Traveller\";\r\n\r\n          const newCustomer = {\r\n            firstName,\r\n            lastName,\r\n            email: booking.email,\r\n            phone: booking.phone || \"\",\r\n            country: booking.nationality || \"Nepalese\",\r\n            isActive: \"true\",\r\n            isVerified: \"false\",\r\n            userType: \"Traveler\",\r\n            isDisabled: \"false\",\r\n            phoneCountryCode: \"+977\", // Default or extract\r\n            dateOfBirth: booking.travellers?.[0]?.dob || booking.dob || \"\",\r\n            gender: \"N/A\",\r\n            address: {}, // JSONB default\r\n            passport: {\r\n              number:\r\n                booking.passportNumber ||\r\n                booking.travellers?.[0]?.passportNumber ||\r\n                \"\",\r\n              expiryDate:\r\n                booking.passportExpiry ||\r\n                booking.travellers?.[0]?.passportExpiry ||\r\n                \"\",\r\n              issueCountry: booking.nationality || \"Nepalese\",\r\n            },\r\n            // created_at: new Date().toISOString(), // Removed to let DB handle it or avoid error if column missing\r\n            // socialProvider: 'email'\r\n          };\r\n\r\n          const { data: createdCustomer, error: createError } = await supabase\r\n            .from(\"customers\")\r\n            .insert([newCustomer])\r\n            .select(\"id\")\r\n            .single();\r\n\r\n          if (createError) {\r\n            console.error(\"Failed to create new customer:\", createError);\r\n            throw new Error(\r\n              `Failed to create customer profile: ${createError.message}`,\r\n            );\r\n          }\r\n\r\n          console.log(\"New customer created successfully:\", createdCustomer.id);\r\n          customerIdToUse = createdCustomer.id;\r\n        } else {\r\n          console.log(\r\n            \"Customer already exists, linking to ID:\",\r\n            customerIdToUse,\r\n          );\r\n        }\r\n\r\n        // Update booking with the customer ID\r\n        bookingToSave.customerid = customerIdToUse;\r\n        // Also update the 'customer' object in the booking to reflect the link immediately in UI if needed\r\n        // bookingToSave.customer = { id: customerIdToUse, ... } as any;\r\n      }\r\n\r\n      if (editingBooking?.id) {\r\n        // Update\r\n        const { error: updateError } = await supabase\r\n          .from(\"bookings\")\r\n          .update(bookingToSave)\r\n          .eq(\"id\", editingBooking.id);\r\n\r\n        if (updateError) throw updateError;\r\n      } else {\r\n        // Create\r\n        const { error: createError } = await supabase\r\n          .from(\"bookings\")\r\n          .insert([bookingToSave]);\r\n\r\n        if (createError) throw createError;\r\n\r\n        // Send confirmation email\r\n        if (booking.email) {\r\n          try {\r\n            await fetch(\"/api/send-email\", {\r\n              method: \"POST\",\r\n              headers: {\r\n                \"Content-Type\": \"application/json\",\r\n              },\r\n              body: JSON.stringify({\r\n                to: booking.email,\r\n                subject: `Booking Confirmation - PNR: ${booking.PNR}`,\r\n                html: `\r\n                  <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; color: #333;\">\r\n                    <h2 style=\"color: #2563eb;\">Booking Confirmation</h2>\r\n                    <p>Dear ${booking.travellers?.[0]?.firstName || \"Customer\"},</p>\r\n                    <p>Your booking has been successfully created.</p>\r\n                    <div style=\"background-color: #f8fafc; padding: 15px; border-radius: 8px; margin: 20px 0;\">\r\n                      <p style=\"margin: 5px 0;\"><strong>PNR:</strong> ${\r\n                        booking.PNR\r\n                      }</p>\r\n                      <p style=\"margin: 5px 0;\"><strong>Route:</strong> ${\r\n                        booking.origin\r\n                      }  ${booking.destination}</p>\r\n                      <p style=\"margin: 5px 0;\"><strong>Travel Date:</strong> ${\r\n                        booking.travelDate || \"N/A\"\r\n                      }</p>\r\n                    </div>\r\n                    <p>Thank you for choosing SkyTrips.</p>\r\n                  </div>\r\n                `,\r\n              }),\r\n            });\r\n          } catch (emailError) {\r\n            console.error(\"Failed to send confirmation email\", emailError);\r\n          }\r\n        }\r\n      }\r\n\r\n      setIsModalOpen(false);\r\n      await fetchBookings();\r\n    } catch (err: any) {\r\n      alert(err.message || \"Failed to save booking\");\r\n      console.error(err);\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status.toLowerCase()) {\r\n      case \"confirmed\":\r\n        return \"bg-emerald-100 text-emerald-800 border-emerald-200\";\r\n      case \"pending\":\r\n        return \"bg-amber-100 text-amber-800 border-amber-200\";\r\n      case \"cancelled\":\r\n        return \"bg-red-100 text-red-800 border-red-200\";\r\n      default:\r\n        return \"bg-slate-100 text-slate-800 border-slate-200\";\r\n    }\r\n  };\r\n\r\n  const getStatusDotColor = (status: string) => {\r\n    switch (status.toLowerCase()) {\r\n      case \"confirmed\":\r\n        return \"bg-emerald-500\";\r\n      case \"pending\":\r\n        return \"bg-amber-500\";\r\n      case \"cancelled\":\r\n        return \"bg-red-500\";\r\n      default:\r\n        return \"bg-slate-500\";\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-96 bg-white\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\r\n          <p className=\"text-slate-500\">Loading bookings...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto w-full font-display\">\r\n      {/* Breadcrumbs */}\r\n      <nav className=\"flex mb-4 text-sm text-slate-500\">\r\n        <ol className=\"flex items-center gap-2\">\r\n          <li>Dashboard</li>\r\n          <li>\r\n            <span className=\"material-symbols-outlined text-[16px]\">\r\n              chevron_right\r\n            </span>\r\n          </li>\r\n          <li className=\"font-medium text-primary\">Bookings</li>\r\n        </ol>\r\n      </nav>\r\n\r\n      {/* Page Header */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-8\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold tracking-tight text-slate-900\">\r\n            Bookings\r\n          </h1>\r\n          <p className=\"mt-1 text-sm text-slate-500\">\r\n            Manage and track all customer flight reservations.\r\n          </p>\r\n        </div>\r\n        <button\r\n          onClick={handleCreate}\r\n          className=\"flex items-center gap-2 rounded-lg bg-primary px-4 py-2.5 text-sm font-bold text-white shadow-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all\"\r\n        >\r\n          <span className=\"material-symbols-outlined text-[20px]\">add</span>\r\n          <span>New Booking</span>\r\n        </button>\r\n      </div>\r\n\r\n      {/* Filters and Search Toolbar */}\r\n      <div className=\"mb-6 flex flex-col sm:flex-row gap-4\">\r\n        <div className=\"relative flex-1 min-w-[200px]\">\r\n          <span className=\"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\">\r\n            search\r\n          </span>\r\n          <input\r\n            className=\"w-full rounded-lg border border-slate-200 bg-white py-2.5 pl-10 pr-4 text-sm text-slate-900 placeholder:text-slate-400 focus:border-primary focus:ring-1 focus:ring-primary\"\r\n            placeholder=\"Search by Name, PNR or Route (Origin/Destination)\"\r\n            type=\"text\"\r\n            value={searchTerm}\r\n            onChange={(e) => setSearchTerm(e.target.value)}\r\n          />\r\n        </div>\r\n        <div className=\"flex gap-4\">\r\n          <select className=\"w-full sm:w-48 rounded-lg border border-slate-200 bg-white py-2.5 pl-3 pr-10 text-sm text-slate-900 focus:border-primary focus:ring-1 focus:ring-primary\">\r\n            <option value=\"\">All Statuses</option>\r\n            <option value=\"confirmed\">Confirmed</option>\r\n            <option value=\"pending\">Pending</option>\r\n            <option value=\"cancelled\">Cancelled</option>\r\n          </select>\r\n          <button className=\"flex items-center justify-center gap-2 rounded-lg border border-slate-200 bg-white px-4 py-2.5 text-sm font-medium text-slate-700 hover:bg-slate-50 transition-colors\">\r\n            <span className=\"material-symbols-outlined text-[20px]\">\r\n              filter_list\r\n            </span>\r\n            <span className=\"hidden sm:inline\">More Filters</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Error Display */}\r\n      {error && (\r\n        <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n          <div className=\"flex items-start gap-3\">\r\n            <span className=\"material-symbols-outlined text-red-600 mt-0.5\">\r\n              error\r\n            </span>\r\n            <div>\r\n              <h3 className=\"text-red-800 font-semibold mb-1\">\r\n                Error Loading Bookings\r\n              </h3>\r\n              <p className=\"text-red-700 text-sm\">{error}</p>\r\n              <div className=\"mt-3 flex gap-2\">\r\n                <button\r\n                  onClick={fetchBookings}\r\n                  className=\"text-sm bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors\"\r\n                >\r\n                  Retry\r\n                </button>\r\n                <a\r\n                  href=\"/dashboard/test-api\"\r\n                  className=\"text-sm bg-white text-red-600 border border-red-600 px-4 py-2 rounded hover:bg-red-50 transition-colors\"\r\n                >\r\n                  Run Diagnostics\r\n                </a>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Data Table Card */}\r\n      <div className=\"flex flex-col rounded-xl border border-slate-200 bg-white shadow-sm overflow-hidden min-h-[400px]\">\r\n        {bookings.length === 0 && !error ? (\r\n          <div className=\"flex-1 p-12 text-center flex flex-col items-center justify-center\">\r\n            <p className=\"text-slate-500 text-lg mb-4 font-display\">\r\n              No bookings found\r\n            </p>\r\n            <button\r\n              onClick={handleCreate}\r\n              className=\"bg-primary hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-bold transition-colors\"\r\n            >\r\n              Create Your First Booking\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full text-left text-sm\">\r\n              <thead className=\"bg-slate-50 text-slate-500 font-semibold uppercase tracking-wider text-xs\">\r\n                <tr>\r\n                  <th\r\n                    scope=\"col\"\r\n                    className=\"px-6 py-4 cursor-pointer group select-none hover:bg-slate-100 transition-colors\"\r\n                    onClick={() => handleSort(\"id\")}\r\n                    aria-sort={\r\n                      sortConfig.key === \"id\"\r\n                        ? sortConfig.direction === \"asc\"\r\n                          ? \"ascending\"\r\n                          : \"descending\"\r\n                        : \"none\"\r\n                    }\r\n                  >\r\n                    <div className=\"flex items-center gap-1\">\r\n                      Booking ID\r\n                      {renderSortIcon(\"id\")}\r\n                    </div>\r\n                  </th>\r\n                  <th\r\n                    scope=\"col\"\r\n                    className=\"px-6 py-4 cursor-pointer group select-none hover:bg-slate-100 transition-colors\"\r\n                    onClick={() => handleSort(\"travellerLastName\")}\r\n                    aria-sort={\r\n                      sortConfig.key === \"travellerLastName\"\r\n                        ? sortConfig.direction === \"asc\"\r\n                          ? \"ascending\"\r\n                          : \"descending\"\r\n                        : \"none\"\r\n                    }\r\n                  >\r\n                    <div className=\"flex items-center gap-1\">\r\n                      T. last name\r\n                      {renderSortIcon(\"travellerLastName\")}\r\n                    </div>\r\n                  </th>\r\n                  <th\r\n                    scope=\"col\"\r\n                    className=\"px-6 py-4 cursor-pointer group select-none hover:bg-slate-100 transition-colors\"\r\n                    onClick={() => handleSort(\"travellerFirstName\")}\r\n                    aria-sort={\r\n                      sortConfig.key === \"travellerFirstName\"\r\n                        ? sortConfig.direction === \"asc\"\r\n                          ? \"ascending\"\r\n                          : \"descending\"\r\n                        : \"none\"\r\n                    }\r\n                  >\r\n                    <div className=\"flex items-center gap-1\">\r\n                      T. First Name\r\n                      {renderSortIcon(\"travellerFirstName\")}\r\n                    </div>\r\n                  </th>\r\n                  <th\r\n                    scope=\"col\"\r\n                    className=\"px-6 py-4 cursor-pointer group select-none hover:bg-slate-100 transition-colors\"\r\n                    onClick={() => handleSort(\"airlines\")}\r\n                    aria-sort={\r\n                      sortConfig.key === \"airlines\"\r\n                        ? sortConfig.direction === \"asc\"\r\n                          ? \"ascending\"\r\n                          : \"descending\"\r\n                        : \"none\"\r\n                    }\r\n                  >\r\n                    <div className=\"flex items-center gap-1\">\r\n                      Airline\r\n                      {renderSortIcon(\"airlines\")}\r\n                    </div>\r\n                  </th>\r\n                  <th\r\n                    scope=\"col\"\r\n                    className=\"px-6 py-4 cursor-pointer group select-none hover:bg-slate-100 transition-colors\"\r\n                    onClick={() => handleSort(\"sellingPrice\")}\r\n                    aria-sort={\r\n                      sortConfig.key === \"sellingPrice\"\r\n                        ? sortConfig.direction === \"asc\"\r\n                          ? \"ascending\"\r\n                          : \"descending\"\r\n                        : \"none\"\r\n                    }\r\n                  >\r\n                    <div className=\"flex items-center gap-1\">\r\n                      S.P\r\n                      {renderSortIcon(\"sellingPrice\")}\r\n                    </div>\r\n                  </th>\r\n                  <th\r\n                    scope=\"col\"\r\n                    className=\"px-6 py-4 cursor-pointer group select-none hover:bg-slate-100 transition-colors\"\r\n                    onClick={() => handleSort(\"tripType\")}\r\n                    aria-sort={\r\n                      sortConfig.key === \"tripType\"\r\n                        ? sortConfig.direction === \"asc\"\r\n                          ? \"ascending\"\r\n                          : \"descending\"\r\n                        : \"none\"\r\n                    }\r\n                  >\r\n                    <div className=\"flex items-center gap-1\">\r\n                      Trip Type\r\n                      {renderSortIcon(\"tripType\")}\r\n                    </div>\r\n                  </th>\r\n                  <th\r\n                    scope=\"col\"\r\n                    className=\"px-6 py-4 cursor-pointer group select-none hover:bg-slate-100 transition-colors\"\r\n                    onClick={() => handleSort(\"PNR\")}\r\n                    aria-sort={\r\n                      sortConfig.key === \"PNR\"\r\n                        ? sortConfig.direction === \"asc\"\r\n                          ? \"ascending\"\r\n                          : \"descending\"\r\n                        : \"none\"\r\n                    }\r\n                  >\r\n                    <div className=\"flex items-center gap-1\">\r\n                      PNR\r\n                      {renderSortIcon(\"PNR\")}\r\n                    </div>\r\n                  </th>\r\n                  <th\r\n                    scope=\"col\"\r\n                    className=\"px-6 py-4 cursor-pointer group select-none hover:bg-slate-100 transition-colors\"\r\n                    onClick={() => handleSort(\"travelDate\")}\r\n                    aria-sort={\r\n                      sortConfig.key === \"travelDate\"\r\n                        ? sortConfig.direction === \"asc\"\r\n                          ? \"ascending\"\r\n                          : \"descending\"\r\n                        : \"none\"\r\n                    }\r\n                  >\r\n                    <div className=\"flex items-center gap-1\">\r\n                      Travel Date\r\n                      {renderSortIcon(\"travelDate\")}\r\n                    </div>\r\n                  </th>\r\n                  <th\r\n                    scope=\"col\"\r\n                    className=\"px-6 py-4 cursor-pointer group select-none hover:bg-slate-100 transition-colors\"\r\n                    onClick={() => handleSort(\"origin\")}\r\n                    aria-sort={\r\n                      sortConfig.key === \"origin\"\r\n                        ? sortConfig.direction === \"asc\"\r\n                          ? \"ascending\"\r\n                          : \"descending\"\r\n                        : \"none\"\r\n                    }\r\n                  >\r\n                    <div className=\"flex items-center gap-1\">\r\n                      Route\r\n                      {renderSortIcon(\"origin\")}\r\n                    </div>\r\n                  </th>\r\n                  <th className=\"px-6 py-4 text-right\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y divide-slate-100\">\r\n                {bookings.map((booking) => (\r\n                  <tr\r\n                    key={booking.id}\r\n                    className=\"group hover:bg-slate-50/50 transition-colors\"\r\n                  >\r\n                    <td className=\"px-6 py-4 font-medium text-slate-900\">\r\n                      {booking.id}\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <span className=\"text-slate-900 font-medium text-sm\">\r\n                        {booking.travellers?.[0]?.lastName ||\r\n                          // booking.travellerLastName || // REMOVED\r\n                          \"N/A\"}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <div\r\n                          className=\"size-9 rounded-full bg-cover bg-center\"\r\n                          style={{\r\n                            backgroundImage: `url(\"https://ui-avatars.com/api/?name=${encodeURIComponent(\r\n                              `${\r\n                                booking.travellers?.[0]?.firstName ||\r\n                                // booking.travellerFirstName || // REMOVED\r\n                                \"\"\r\n                              } ${\r\n                                booking.travellers?.[0]?.lastName ||\r\n                                // booking.travellerLastName || // REMOVED\r\n                                \"\"\r\n                              }`,\r\n                            )}&background=random\")`,\r\n                          }}\r\n                        ></div>\r\n                        <span className=\"text-slate-900 font-medium text-sm\">\r\n                          {booking.travellers?.[0]?.firstName || \"N/A\"}\r\n                        </span>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <span className=\"text-slate-600\">{booking.airlines}</span>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <span className=\"text-slate-900 font-semibold\">\r\n                        {booking.sellingPrice || booking.buyingPrice || \"0.00\"}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <span className=\"text-slate-600\">{booking.tripType}</span>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <span className=\"bg-blue-50 text-primary px-2 py-1 rounded text-xs font-bold\">\r\n                        {booking.PNR}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"flex flex-col gap-1\">\r\n                        {booking.travellers && booking.travellers.length > 0 ? (\r\n                          booking.travellers.map((t, idx) => (\r\n                            <span\r\n                              key={idx}\r\n                              className=\"text-slate-900 font-medium text-sm\"\r\n                            >\r\n                              {t.eticketNumber || \"N/A\"}\r\n                            </span>\r\n                          ))\r\n                        ) : (\r\n                          <></>\r\n                        )}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"flex flex-col\">\r\n                        <span className=\"text-slate-900 font-medium\">\r\n                          {booking.departureDate ||\r\n                            booking.travelDate ||\r\n                            `${booking.IssueDay || \"\"} ${\r\n                              booking.issueMonth || \"\"\r\n                            } ${booking.issueYear || \"\"}`}\r\n                        </span>\r\n                        {booking.returnDate && (\r\n                          <span className=\"text-xs text-slate-500\">\r\n                            to {booking.returnDate}\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4\">\r\n                      <div className=\"flex items-center gap-2 text-sm font-medium text-slate-900\">\r\n                        <span className=\"text-slate-600 font-bold\">\r\n                          {booking.origin}\r\n                        </span>\r\n                        <span className=\"material-symbols-outlined text-xs text-slate-400\">\r\n                          arrow_forward\r\n                        </span>\r\n                        {booking.transit && (\r\n                          <>\r\n                            <span className=\"text-slate-600 font-bold\">\r\n                              {booking.transit}\r\n                            </span>\r\n                            <span className=\"material-symbols-outlined text-xs text-slate-400\">\r\n                              arrow_forward\r\n                            </span>\r\n                          </>\r\n                        )}\r\n                        <span className=\"text-slate-600 font-bold\">\r\n                          {booking.destination}\r\n                        </span>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 text-right align-top\">\r\n                      <div className=\"inline-flex flex-col items-end gap-2\">\r\n                        <div className=\"flex items-center justify-end gap-4\">\r\n                          <button\r\n                            onClick={() => handleView(booking)}\r\n                            className=\"rounded p-2 text-slate-600 hover:bg-slate-100 hover:text-primary transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary/30\"\r\n                            aria-label=\"View booking\"\r\n                            tabIndex={0}\r\n                          >\r\n                            <span className=\"material-symbols-outlined text-[18px] transition-transform duration-200 hover:scale-105\">\r\n                              visibility\r\n                            </span>\r\n                          </button>\r\n                          <button\r\n                            onClick={() =>\r\n                              router.push(\r\n                                `/dashboard/booking/edit/${booking.id}`,\r\n                              )\r\n                            }\r\n                            className=\"rounded p-2 text-slate-600 hover:bg-slate-100 hover:text-primary transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary/30\"\r\n                            aria-label=\"Edit booking\"\r\n                            tabIndex={0}\r\n                          >\r\n                            <span className=\"material-symbols-outlined text-[18px] transition-transform duration-200 hover:scale-105\">\r\n                              edit\r\n                            </span>\r\n                          </button>\r\n                        </div>\r\n                        <BookingRowMenu\r\n                          booking={booking}\r\n                          onRefund={() =>\r\n                            router.push(`/dashboard/manage-booking`)\r\n                          }\r\n                          onReissue={() => router.push(`/dashboard/booking/`)}\r\n                        />\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n\r\n        {/* Pagination */}\r\n        <div className=\"px-6 py-4 border-t border-slate-100 flex items-center justify-between gap-4 bg-white\">\r\n          <div className=\"flex-1 flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <p className=\"text-sm text-slate-500 font-display\">\r\n                Showing{\" \"}\r\n                <span className=\"font-medium text-slate-900\">\r\n                  {totalCount === 0 ? 0 : (currentPage - 1) * pageSize + 1}\r\n                </span>{\" \"}\r\n                to{\" \"}\r\n                <span className=\"font-medium text-slate-900\">\r\n                  {Math.min(currentPage * pageSize, totalCount)}\r\n                </span>{\" \"}\r\n                of{\" \"}\r\n                <span className=\"font-medium text-slate-900\">{totalCount}</span>{\" \"}\r\n                results\r\n              </p>\r\n              <div className=\"hidden sm:flex items-center gap-2 ml-4 border-l border-slate-100 pl-4\">\r\n                <span className=\"text-xs text-slate-500\">Rows per page:</span>\r\n                <select\r\n                  value={pageSize}\r\n                  onChange={(e) => {\r\n                    setPageSize(Number(e.target.value));\r\n                    setCurrentPage(1);\r\n                  }}\r\n                  className=\"bg-transparent text-sm font-bold text-slate-900 focus:outline-none cursor-pointer\"\r\n                >\r\n                  <option value={10}>10</option>\r\n                  <option value={20}>20</option>\r\n                  <option value={50}>50</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-2\">\r\n              <nav\r\n                aria-label=\"Pagination\"\r\n                className=\"isolate inline-flex -space-x-px rounded-md shadow-sm\"\r\n              >\r\n                <button\r\n                  onClick={handlePrevPage}\r\n                  disabled={currentPage === 1 || loading}\r\n                  className=\"relative inline-flex items-center rounded-l-md px-2 py-2 text-slate-400 ring-1 ring-inset ring-slate-100 hover:bg-slate-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n                >\r\n                  <span className=\"sr-only\">Previous</span>\r\n                  <span className=\"material-symbols-outlined text-[20px]\">\r\n                    chevron_left\r\n                  </span>\r\n                </button>\r\n\r\n                <div className=\"flex items-center px-4 py-2 text-sm font-semibold text-slate-900 ring-1 ring-inset ring-slate-100\">\r\n                  Page{\" \"}\r\n                  <span className=\"mx-1 font-bold text-primary\">\r\n                    {currentPage}\r\n                  </span>{\" \"}\r\n                  of {totalPages || 1}\r\n                </div>\r\n\r\n                <button\r\n                  onClick={handleNextPage}\r\n                  disabled={\r\n                    currentPage === totalPages || totalPages === 0 || loading\r\n                  }\r\n                  className=\"relative inline-flex items-center rounded-r-md px-2 py-2 text-slate-400 ring-1 ring-inset ring-slate-100 hover:bg-slate-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n                >\r\n                  <span className=\"sr-only\">Next</span>\r\n                  <span className=\"material-symbols-outlined text-[20px]\">\r\n                    chevron_right\r\n                  </span>\r\n                </button>\r\n              </nav>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <BookingModal\r\n        isOpen={isModalOpen}\r\n        onClose={() => setIsModalOpen(false)}\r\n        onSave={handleSave}\r\n        onEdit={() => setIsViewOnly(false)}\r\n        booking={editingBooking}\r\n        isLoading={actionLoading === -1}\r\n        isReadOnly={isViewOnly}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}